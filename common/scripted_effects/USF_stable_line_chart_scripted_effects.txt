USF_test_line = {
    clear_array = USF_economic_discount_numbers_actual
    add_to_array = { USF_economic_discount_numbers_actual = 62.7 }
    add_to_array = { USF_economic_discount_numbers_actual = 60.9 }
    add_to_array = { USF_economic_discount_numbers_actual = 57.62 }
    add_to_array = { USF_economic_discount_numbers_actual = 55.7 }
    add_to_array = { USF_economic_discount_numbers_actual = 52.1 }
    add_to_array = { USF_economic_discount_numbers_actual = 51.3 }
    USF_calculate_economic_line_chart = yes
}

USF_calculate_economic_line_chart_weekly = {
    set_temp_variable = { temp_stability = usf.stability } #stability 0~1
    multiply_temp_variable = { temp_stability = 100 }
    add_to_array = { USF_economic_discount_numbers_actual = temp_stability }
    remove_from_array = {
        array = USF_economic_discount_numbers_actual
        index = 0
    }
    USF_calculate_economic_line_chart = yes
}

#计算黒沫夜折线图
USF_calculate_economic_line_chart = {
    #查找图表的最大和最小值
    #USF_economic_discount_y_label为y坐标，USF_economic_discount_frame_label是角度
    #USF_economic_discount_numbers存储真数值

    clear_array = USF_economic_discount_numbers
    clear_array = USF_economic_discount_y_label
    clear_array = USF_economic_discount_frame_label
    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers_actual^num
        value = i
        set_temp_variable = { v = USF_economic_discount_numbers_actual^i }
        multiply_temp_variable = { v = 0.72 }
        add_to_array = { USF_economic_discount_numbers = v }
    }
    set_temp_variable = { min = USF_economic_discount_numbers^0 }
    set_temp_variable = { max = USF_economic_discount_numbers^0 }
    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers^num
        value = i
        if = {
            limit = { check_variable = { USF_economic_discount_numbers^i > max } }
            log = "找到了更大的：原：[?max] 现：[?USF_economic_discount_numbers^i]"
            set_temp_variable = { max = USF_economic_discount_numbers^i }
        }
        if = {
            limit = { check_variable = { USF_economic_discount_numbers^i < min } }
            set_temp_variable = { min = USF_economic_discount_numbers^i }
        }
    }

    #随意移动或修改
    #我们的范围是（最小值/1.1）-（最大值*1.1）
    set_temp_variable = { max2 = max }
    multiply_temp_variable = { max = 1.3 }
    set_temp_variable = { min2 = min }
    divide_temp_variable = { min = 1.3 }

    set_temp_variable = { range = max } #范围
    subtract_from_temp_variable = { range = min }
    divide_temp_variable = { range = 50 }

    set_temp_variable = { range2 = max2 } #范围
    subtract_from_temp_variable = { range2 = min2 }
    divide_temp_variable = { range2 = 50 }

    log = "最大值：[?max]"
    log = "最小值：[?min]"
    log = "范围：[?range]"

    #计算新坐标
    clear_array = USF_economic_discount_numbers
    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers_actual^num
        value = i
        set_temp_variable = { v = USF_economic_discount_numbers_actual^i }
        subtract_from_temp_variable = { v = min }
        divide_temp_variable = { v = range }
        add_to_array = { USF_economic_discount_numbers = v }
    }

    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers^num
        value = i
        log = "----------第[?i]次计算----------"
        set_temp_variable = { last = i }
        subtract_from_temp_variable = { last = 1 }

        #计算y坐标 要负数
        set_temp_variable = { last_variable = USF_economic_discount_numbers^last }
        log = "上一个数大小为(坐标)：[?last_variable]"
        multiply_temp_variable = { last_variable = -1 }
        # add_to_temp_variable = { last_variable = 90 }
        log = "存入(坐标)：[?last_variable]"
        add_to_array = { USF_economic_discount_y_label = last_variable }

        #计算角度 必须等于（y2-y1）/2+50
        log = "当前角度为：[?USF_economic_discount_numbers^i]"
        set_temp_variable = { current = USF_economic_discount_numbers^i }
        subtract_from_temp_variable = { current = USF_economic_discount_numbers^last }
        log = "减去上一个后角度为：[?current]"
        divide_temp_variable = { current = 2 }
        add_to_temp_variable = { current = 50 }
        log = "最终存入角度为：[?current]"
        add_to_array = { USF_economic_discount_frame_label = current }
    }

    #计算目标线位置 有个偏移y=3
    #y最大是75最小是5 （加上偏移量）

    set_temp_variable = { USF_stable_line_chart_expectation_y_temp = 70 } #目标值
    # multiply_temp_variable = { USF_stable_line_chart_expectation_y_temp = 0.72 } #与上方同等缩小
    subtract_from_temp_variable = { USF_stable_line_chart_expectation_y_temp = min }
    log = "传入目标线y坐标：[?USF_stable_line_chart_expectation_y_temp]"
    divide_temp_variable = { USF_stable_line_chart_expectation_y_temp = range }
    multiply_temp_variable = { USF_stable_line_chart_expectation_y_temp = -1 }
    add_to_temp_variable = { USF_stable_line_chart_expectation_y_temp = 75 }
    set_variable = { USF_stable_line_chart_expectation_y = USF_stable_line_chart_expectation_y_temp }
}


#卡牌测试用
player_slot_machine_numbers_button_debug = {
    for_loop_effect = { #关闭动画
        end = ROOT.player_hand_array^num
        value = var
        set_variable = { ROOT.player_hand_array_animation^var = 0 }
    }

    if = {
        limit = { check_variable = { ROOT.player_hand_array^num < 8 } }
        # if = {
        #     limit = { check_variable = { player_hand_button_1_update = 0 } }
        #     set_variable = { player_hand_button_1_update = 1 }
        # }
        add_to_array = { ROOT.player_hand_array_animation = 801000 }
        add_to_array = { ROOT.player_hand_array_x = 300 }

        # add_to_variable = { player_hand_button_1_update = 1 }
        # if = {
        #     limit = {
        #         check_variable = { player_hand_button_1_update = 2 }
        #     }
        #     set_variable = { player_hand_button_1_update = 0 }
        # }
        meta_effect = {
            text = {
                add_to_variable = { ROOT.player_hand_button_[V]_update = 1 }
                modulo_variable = { ROOT.player_hand_button_[V]_update = 2 }
            }
            V = "[?ROOT.player_hand_array^num]"
        }
    }
    else = {
        clear_array = ROOT.player_hand_array_animation
        clear_array = ROOT.player_hand_array
        clear_array = ROOT.player_hand_array_x
    }

    for_loop_effect = { #关闭动画
        end = ROOT.player_hand_array^num
        value = var
        log = "ROOT.player_hand_array_animation^[?var]=[?ROOT.player_hand_array_animation^var]"
    }
    log = "ROOT.player_hand_array^num=[?ROOT.player_hand_array^num]"
    log = "ROOT.player_hand_array_animation^num=[?ROOT.player_hand_array_animation^num]"
    log = "ROOT.player_hand_array_x^num=[?ROOT.player_hand_array_x^num]"
    log = "卡牌动画启用数值=[?player_hand_button_1_update]"




    # set_variable = { ROOT.player_hand_array_animation^0 = 401010 }

    # clear_array = ROOT.player_hand_array_animation
    # clear_array = ROOT.player_hand_array
    # clear_array = ROOT.player_hand_array_x




    ########################################

    add_to_variable = { USF_player_slot_machine_numbers_icon_1_update = 1 }
    if = {
        limit = {
            check_variable = { USF_player_slot_machine_numbers_icon_1_update = 2 }
        }
        set_variable = { USF_player_slot_machine_numbers_icon_1_update = 0 }
    }
    add_to_variable = { USF_player_promotion_coefficient_numbers_icon_1_update = 1 }
    if = {
        limit = {
            check_variable = { USF_player_promotion_coefficient_numbers_icon_1_update = 2 }
        }
        set_variable = { USF_player_promotion_coefficient_numbers_icon_1_update = 0 }
    }
    add_to_variable = { USF_player_public_opinion_progress_bar_g_update = 1 }
    if = {
        limit = {
            check_variable = { USF_player_public_opinion_progress_bar_g_update = 2 }
        }
        set_variable = { USF_player_public_opinion_progress_bar_g_update = 0 }
    }


    # set_variable_to_random = {
    #     var = USF_player_slot_machine_numbers_icon_1_random
    #     max = 999
    #     min = 100
    #     integer = yes
    # }
    # multiply_temp_variable = { USF_player_slot_machine_numbers_icon_1_random = 100 }
    # set_variable = { USF_player_slot_machine_numbers_icon_1_random_v = USF_player_slot_machine_numbers_icon_1_random }
    # log = "[?USF_player_slot_machine_numbers_icon_1_random_v]"
    if = {
        limit = {
            OR = {
                check_variable = { USF_player_slot_machine_numbers_icon_1_random = 0 }
                check_variable = { USF_player_slot_machine_numbers_icon_1_random = 53047 }
            }
        }
        set_variable = { USF_player_slot_machine_numbers_icon_1_random = 47053 }
    }
    else = {
        set_variable = { USF_player_slot_machine_numbers_icon_1_random = 53047 }
    }
    if = {
        limit = {
            OR = {
                check_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 0 }
                check_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 9000 }
            }
        }
        set_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 9 }
    }
    else = {
        set_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 9000 }
    }
    if = {
        limit = {
            OR = {
                check_variable = { USF_player_public_opinion_progress_bar_g_random = 0 }
                check_variable = { USF_player_public_opinion_progress_bar_g_random = 50080 }
            }
        }
        set_variable = { USF_player_public_opinion_progress_bar_g_random = 80050 }
    }
    else = {
        set_variable = { USF_player_public_opinion_progress_bar_g_random = 50080 }
    }



    #测试 删除所有出牌
    clear_array = ROOT.player_play_area_array
    clear_array = ROOT.player_play_area_array_animation
    clear_array = ROOT.player_play_area_hole_array
    clear_array = ROOT.player_play_area_hole_array_animation

    #增加手牌次数
    set_variable = { player_exposed_small_hand = 1 }
    set_variable = { player_unfaced_small_hand = 1 }
}


#卡牌打出动画结束后更新手牌位置
USF_update_player_hand_position_after_animation = {
    set_variable = { ROOT.player_hand_array_animation^frame_temp = 501000 }
    set_variable = { ROOT.player_hand_array_x^frame_temp = 0 }

    for_loop_effect = {
        end = ROOT.player_hand_array^num
        value = var
        # log = "player_hand_array_i=[?var]"
        if = {
            limit = { check_variable = { frame_temp < var } }
            # log = "player_hand_array_i<var，修改一格动画"
            set_variable = { ROOT.player_hand_array_animation^var = 141000 }
            meta_effect = {
                text = {
                    add_to_variable = { ROOT.player_hand_button_[V]_update = 1 }
                    modulo_variable = { ROOT.player_hand_button_[V]_update = 2 }
                }
                V = "[?var]"
            }
        }
        # else = {
        #     # log = "player_hand_array_i>var，删除动画"
        #     set_variable = { ROOT.player_hand_array_animation^var = 0 }
        # }
    }

    # add_to_variable = { player_hand_button_1_update = 1 }
    # if = {
    #     limit = {
    #         check_variable = { player_hand_button_1_update = 2 }
    #     }
    #     set_variable = { player_hand_button_1_update = 0 }
    # }

    if = {
        limit = {
            check_variable = { ROOT.player_hand_array^frame_temp = 1 }
            check_variable = { ROOT.player_exposed_small_hand > 0 }
        }
        USF_player_play_area_card_issuing = yes

        remove_from_array = {
            array = ROOT.player_hand_array
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_animation
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_x
            index = frame_temp
        }
    }
    else_if = {
        limit = {
            check_variable = { ROOT.player_unfaced_small_hand > 0 }
            OR = {
                check_variable = { ROOT.player_hand_array^frame_temp = 2 }
                check_variable = { ROOT.player_hand_array^frame_temp = 3 }
                check_variable = { ROOT.player_hand_array^frame_temp = 4 }
                check_variable = { ROOT.player_hand_array^frame_temp = 5 }
            }
        }
        USF_player_play_area_card_issuing_hole = yes

        remove_from_array = {
            array = ROOT.player_hand_array
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_animation
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_x
            index = frame_temp
        }
    }
    else = {
        #清除所有手牌移动动画
        for_loop_effect = {
            end = ROOT.player_hand_array^num
            value = var
            set_variable = { ROOT.player_hand_array_animation^var = 0 }
        }
    }

    set_variable = { player_hand_array_output = frame_temp }
    log = "卡牌动画启用数值=[?player_hand_button_1_update]"
}


#打出卡牌
USF_player_play_area_card_issuing = {
    add_to_variable = { player_exposed_small_hand = -1 }
    add_to_variable = { ROOT.player_play_area_icon_update = 1 }
    if = {
        limit = {
            check_variable = { ROOT.player_play_area_icon_update = 2 }
        }
        set_variable = { ROOT.player_play_area_icon_update = 0 }
    }

    #清空动画
    for_loop_effect = {
        end = ROOT.player_play_area_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_array_animation^var = 0 }
    }
    for_loop_effect = {
        end = ROOT.player_play_area_hole_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_hole_array_animation^var = 0 }
    }

    #存入卡组
    add_to_array = { ROOT.player_play_area_array = ROOT.player_hand_array^frame_temp }

    #播放出牌动画######################
    #判定出牌位置 如果第一张牌 出卡槽一 输入2 如果是1，则不播放
    # set_temp_variable = { card_slot_insertion_point = ROOT.player_play_area_array^num }
    if = {
        limit = { check_variable = { ROOT.player_play_area_array^num = 1 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 2 }
        add_to_array = { ROOT.player_play_area_array_animation = card_slot_insertion_point_animation_temp }
    }
    else_if = {
        limit = { check_variable = { ROOT.player_play_area_array^num = 2 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 9 }
        add_to_array = { ROOT.player_play_area_array_animation = card_slot_insertion_point_animation_temp }
    }
    else_if = {
        limit = { check_variable = { ROOT.player_play_area_array^num = 3 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 16 }
        add_to_array = { ROOT.player_play_area_array_animation = card_slot_insertion_point_animation_temp }
    }
}

#打出卡牌 暗牌
USF_player_play_area_card_issuing_hole = {
    add_to_variable = { player_unfaced_small_hand = -1 }
    add_to_variable = { ROOT.player_play_area_icon_update = 1 }
    if = {
        limit = {
            check_variable = { ROOT.player_play_area_icon_update = 2 }
        }
        set_variable = { ROOT.player_play_area_icon_update = 0 }
    }

    #清空动画
    for_loop_effect = {
        end = ROOT.player_play_area_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_array_animation^var = 0 }
    }
    for_loop_effect = {
        end = ROOT.player_play_area_hole_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_hole_array_animation^var = 0 }
    }

    #存入卡组
    add_to_array = { ROOT.player_play_area_hole_array = ROOT.player_hand_array^frame_temp }

    #播放出牌动画######################
    #判定出牌位置 如果第一张牌 出卡槽一 输入2 如果是1，则不播放
    if = {
        limit = { check_variable = { ROOT.player_play_area_hole_array^num = 1 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 23 }
        add_to_array = { ROOT.player_play_area_hole_array_animation = card_slot_insertion_point_animation_temp }
    }
    else_if = {
        limit = { check_variable = { ROOT.player_play_area_hole_array^num = 2 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 30 }
        add_to_array = { ROOT.player_play_area_hole_array_animation = card_slot_insertion_point_animation_temp }
    }
}




#干涉彼岸洋#############################

#刷新所有地区数据
USF_OCF_refresh_all_regional_data = {
    every_state = {
        limit = {
            OCF_computable_region_triggers = yes
        }
        USF_OCF_refresh_regional_support_rate = yes
    }
    OCF_region_supports_formatting = yes
}

#刷新地区支持率
USF_OCF_refresh_regional_support_rate = {
    LOG = "刷新彼岸洋地区支持率计算"
    OCF = {
        #计算获胜派系 直接复用大洋的计算方法
        OCF_calculate_winning_usage = yes
    }
    #读取该地区每个党派数量算总数
    set_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^1
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^2
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^3
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^4
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^5
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^6
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^7
    }
    add_to_variable = {
        THIS.regional_support_rate = THIS.OCF_regional_support_rate^8
    }
    #保留原数据
    set_variable = {
        THIS.regional_support_rate_100 = THIS.regional_support_rate
    }
    multiply_variable = {
        THIS.regional_support_rate_100 = 0.01
    }
    #计算占比
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^2 = THIS.OCF_regional_support_rate^2
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^1 = THIS.OCF_regional_support_rate_proportion^2
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^1 = THIS.OCF_regional_support_rate^1
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^5 = THIS.OCF_regional_support_rate_proportion^1
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^5 = THIS.OCF_regional_support_rate^5
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^3 = THIS.OCF_regional_support_rate_proportion^5
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^3 = THIS.OCF_regional_support_rate^3
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^4 = THIS.OCF_regional_support_rate_proportion^3
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^4 = THIS.OCF_regional_support_rate^4
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^7 = THIS.OCF_regional_support_rate_proportion^4
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^7 = THIS.OCF_regional_support_rate^7
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^8 = THIS.OCF_regional_support_rate_proportion^7
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^8 = THIS.OCF_regional_support_rate^8
    }
    set_variable = {
        THIS.OCF_regional_support_rate_proportion^6 = THIS.OCF_regional_support_rate_proportion^8
    }
    add_to_variable = {
        THIS.OCF_regional_support_rate_proportion^6 = THIS.OCF_regional_support_rate^6
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^1 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^2 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^3 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^4 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^5 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^6 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^7 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_proportion^8 = THIS.regional_support_rate_100
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^1 = THIS.OCF_regional_support_rate^1
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^2 = THIS.OCF_regional_support_rate^2
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^3 = THIS.OCF_regional_support_rate^3
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^4 = THIS.OCF_regional_support_rate^4
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^5 = THIS.OCF_regional_support_rate^5
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^6 = THIS.OCF_regional_support_rate^6
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^7 = THIS.OCF_regional_support_rate^7
    }
    set_variable = {
        THIS.OCF_regional_support_rate_storage^8 = THIS.OCF_regional_support_rate^8
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^1 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^2 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^3 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^4 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^5 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^6 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^7 = THIS.regional_support_rate_100
    }
    divide_variable = {
        THIS.OCF_regional_support_rate_storage^8 = THIS.regional_support_rate_100
    }
    #把数据传入后端， 显示饼图
    ROOT = {
        set_variable = {
            ROOT.factions_region^1 = PREV.OCF_regional_support_rate_proportion^1
        }
        set_variable = {
            ROOT.factions_region^2 = PREV.OCF_regional_support_rate_proportion^2
        }
        set_variable = {
            ROOT.factions_region^3 = PREV.OCF_regional_support_rate_proportion^3
        }
        set_variable = {
            ROOT.factions_region^4 = PREV.OCF_regional_support_rate_proportion^4
        }
        set_variable = {
            ROOT.factions_region^5 = PREV.OCF_regional_support_rate_proportion^5
        }
        set_variable = {
            ROOT.factions_region^6 = PREV.OCF_regional_support_rate_proportion^6
        }
        set_variable = {
            ROOT.factions_region^7 = PREV.OCF_regional_support_rate_proportion^7
        }
        set_variable = {
            ROOT.factions_region^8 = PREV.OCF_regional_support_rate_proportion^8
        }
        #储存真实百分比
        set_variable = {
            THIS.OCF_regional_support_rate_storage^1 = PREV.OCF_regional_support_rate_storage^1
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^2 = PREV.OCF_regional_support_rate_storage^2
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^3 = PREV.OCF_regional_support_rate_storage^3
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^4 = PREV.OCF_regional_support_rate_storage^4
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^5 = PREV.OCF_regional_support_rate_storage^5
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^6 = PREV.OCF_regional_support_rate_storage^6
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^7 = PREV.OCF_regional_support_rate_storage^7
        }
        set_variable = {
            THIS.OCF_regional_support_rate_storage^8 = PREV.OCF_regional_support_rate_storage^8
        }
    }
    #计算当前最高值和计算可能胜选党派
    set_variable = {
        THIS.regional_leaders = THIS.OCF_regional_support_rate^1
    }
    set_variable = {
        THIS.USF_regional_leaders_2 = 1
    }
    set_variable = {
        PREV.OCF_superior_victory_1 = 0
    }
    #初始化各个党派
    set_variable = {
        PREV.OCF_superior_victory_2 = 0
    }
    set_variable = {
        PREV.OCF_superior_victory_3 = 0
    }
    set_variable = {
        PREV.OCF_superior_victory_4 = 0
    }
    set_variable = {
        PREV.OCF_superior_victory_5 = 0
    }
    set_variable = {
        PREV.OCF_superior_victory_6 = 0
    }
    set_variable = {
        PREV.OCF_superior_victory_7 = 0
    }
    set_variable = {
        PREV.OCF_superior_victory_8 = 0
    }


    set_temp_variable = { temp_tag = OCF }
    set_variable = { OCF_refresh_regional_support_rate_temp_id = THIS }
    log = "检查[prev.GetName]是否控制[this.GetName]"
    #要控制当地
    if = {
        limit = {
            OR = {
                OCF = { controls_state = var:OCF_refresh_regional_support_rate_temp_id }
                var:OCF_refresh_regional_support_rate_temp_id = {
                    controller = {
                        OR = {
                            is_puppet_of = OCF
                            original_tag = OCF
                        }
                    }
                }
            }
        }
        # log = "控制了[this.GetName]"
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^2
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^2
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 2
            }
            add_to_variable = {
                PREV.OCF_superior_victory_2 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^3
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^3
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 3
            }
            add_to_variable = {
                PREV.OCF_superior_victory_3 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^4
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^4
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 4
            }
            add_to_variable = {
                PREV.OCF_superior_victory_4 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^5
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^5
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 5
            }
            add_to_variable = {
                PREV.OCF_superior_victory_5 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^6
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^6
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 6
            }
            add_to_variable = {
                PREV.OCF_superior_victory_6 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^7
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^7
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 7
            }
            add_to_variable = {
                PREV.OCF_superior_victory_7 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.regional_leaders < THIS.OCF_regional_support_rate^8
                }
            }
            set_variable = {
                THIS.regional_leaders = THIS.OCF_regional_support_rate^8
            }
            set_variable = {
                THIS.USF_regional_leaders_2 = 8
            }
            add_to_variable = {
                PREV.OCF_superior_victory_8 = 1
            }
        }
        if = {
            limit = {
                check_variable = {
                    THIS.USF_regional_leaders_2 = 1
                }
            }
            add_to_variable = {
                PREV.OCF_superior_victory_1 = 1
            }
        }
    }
    else = {
        #控制当地
        set_variable = { THIS.USF_regional_leaders_2 = 10 }
    }


    #计算可能胜出党派
    set_variable = {
        PREV.OCF_superior_victory_0 = 0
    }
    #胜选派
    set_variable = {
        PREV.OCF_superior_victory_max = 0
    }
    #最大胜选派
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_1 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 1
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_2 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 2
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_3 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 3
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_4 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 4
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_5 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 5
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_6 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 6
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_7 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 7
        }
    }
    if = {
        limit = {
            check_variable = {
                PREV.OCF_superior_victory_8 > PREV.OCF_superior_victory_max
            }
        }
        set_variable = {
            PREV.OCF_superior_victory_0 = 8
        }
    }
    if = {
        limit = {
            NOT = {
                var:OCF_refresh_regional_support_rate_temp_id = {
                    controller = {
                        OR = {
                            is_puppet_of = ROOT
                            original_tag = ROOT
                        }
                    }
                }
            }
        }
        set_variable = { PREV.OCF_superior_victory_0 = -1 }
    }
    OCF_government_authority = yes
    OCF = {
        OCF_refresh_pie_chart_percentage_coordinates = yes
    }
}

POC_setup_influence = {
    OCF = {
        set_variable = { PCO_eia_Balance = 33 }
        set_variable = { PCO_usf_Balance = 33 }
        set_variable = { PCO_ocf_Balance = 33 }

        set_variable = { global.influence_oceanic_government_progress_f = 90 }

        calculate_PenetratingOceanCouncil_XY = yes

        USF_OCF_refresh_all_regional_data = yes
        set_variable = { OCF_select_region_variable = 115 }
        115 = { USF_OCF_refresh_regional_support_rate = yes }
		OCF_refresh_pie_chart_percentage_coordinates = yes
    }

    USF = {
        USF_OCF_refresh_all_regional_data = yes
        set_variable = { OCF_select_region_variable = 115 }
        115 = { USF_OCF_refresh_regional_support_rate = yes }
		OCF_refresh_pie_chart_percentage_coordinates = yes
    }

    NAC = {
        USF_OCF_refresh_all_regional_data = yes
        set_variable = { OCF_select_region_variable = 115 }
        115 = { USF_OCF_refresh_regional_support_rate = yes }
		OCF_refresh_pie_chart_percentage_coordinates = yes
    }
}

#计算坐标
calculate_PenetratingOceanCouncil_XY = {
    OCF = {
        POC_clamp_influences = yes

        set_temp_variable = { A = PCO_eia_Balance } #左下
        set_temp_variable = { B = PCO_usf_Balance } #右下
        set_temp_variable = { C = PCO_ocf_Balance } #上
        # ABC = A+B+C
        set_temp_variable = { ABC = A }
        add_to_temp_variable = { ABC = B }
        add_to_temp_variable = { ABC = C }

        ## 计算 X
        # 1/2 * ((B-A)/(A+B+C))
        set_variable = { PenetratingOceanCouncil_X = B }
        subtract_from_variable = { PenetratingOceanCouncil_X = A }
        divide_variable = { PenetratingOceanCouncil_X = ABC }	#A+B+C

        ## 计算 Y
        # sqrt(3)/2 * ((C)/(A+B+C))
        set_variable = { PenetratingOceanCouncil_Y = C }
        divide_variable = { PenetratingOceanCouncil_Y = ABC }	#A+B+C

        multiply_variable = { PenetratingOceanCouncil_X = 180 }
        multiply_variable = { PenetratingOceanCouncil_Y = 312 }
        multiply_variable = { PenetratingOceanCouncil_Y = -1 }
        add_to_variable = { PenetratingOceanCouncil_Y = 314 }
        add_to_variable = { PenetratingOceanCouncil_X = 183 }
    }
}

#防溢出
POC_clamp_influences = {
    OCF = {
        if = {
            limit = { check_variable = { PCO_eia_Balance < 0 } }
            set_variable = { PCO_eia_Balance = 0 }
        }
        if = {
            limit = { check_variable = { PCO_usf_Balance < 0 } }
            set_variable = { PCO_usf_Balance = 0 }
        }
        if = {
            limit = { check_variable = { PCO_ocf_Balance < 0 } }
            set_variable = { PCO_ocf_Balance = 0 }
        }

        ## Temp Variable Definition
        # ABC = A+B+C
        set_temp_variable = { ABC = PCO_eia_Balance }
        add_to_temp_variable = { ABC = PCO_usf_Balance }
        add_to_temp_variable = { ABC = PCO_ocf_Balance }

        divide_temp_variable = { ABC = 99 }
        divide_variable = { PCO_eia_Balance = ABC }
        divide_variable = { PCO_usf_Balance = ABC }
        divide_variable = { PCO_ocf_Balance = ABC }
    }
}

POC_increase_influence_OCF_1 = {
    custom_effect_tooltip = POC_increase_influence_OCF_1_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -0.5 }
        add_to_variable = { PCO_usf_Balance = -0.5 }
        add_to_variable = { PCO_ocf_Balance = 1 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_increase_influence_OCF_2 = {
    custom_effect_tooltip = POC_increase_influence_OCF_2_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -1 }
        add_to_variable = { PCO_usf_Balance = -1 }
        add_to_variable = { PCO_ocf_Balance = 2 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_increase_influence_OCF_3 = {
    custom_effect_tooltip = POC_increase_influence_OCF_3_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -2.5 }
        add_to_variable = { PCO_usf_Balance = -2.5 }
        add_to_variable = { PCO_ocf_Balance = 5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_OCF_1 = {
    custom_effect_tooltip = POC_reduce_influence_OCF_1_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 0.5 }
        add_to_variable = { PCO_usf_Balance = 0.5 }
        add_to_variable = { PCO_ocf_Balance = -1 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_OCF_2 = {
    custom_effect_tooltip = POC_reduce_influence_OCF_2_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 1 }
        add_to_variable = { PCO_usf_Balance = 1 }
        add_to_variable = { PCO_ocf_Balance = -2 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_OCF_3 = {
    custom_effect_tooltip = POC_reduce_influence_OCF_3_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 2.5 }
        add_to_variable = { PCO_usf_Balance = 2.5 }
        add_to_variable = { PCO_ocf_Balance = -5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}

POC_increase_influence_EIA_1 = {
    custom_effect_tooltip = POC_increase_influence_EIA_1_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 1 }
        add_to_variable = { PCO_usf_Balance = -0.5 }
        add_to_variable = { PCO_ocf_Balance = -0.5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_increase_influence_EIA_2 = {
    custom_effect_tooltip = POC_increase_influence_EIA_2_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 2 }
        add_to_variable = { PCO_usf_Balance = -1 }
        add_to_variable = { PCO_ocf_Balance = -1 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_increase_influence_EIA_3 = {
    custom_effect_tooltip = POC_increase_influence_EIA_3_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 5}
        add_to_variable = { PCO_usf_Balance = -2.5 }
        add_to_variable = { PCO_ocf_Balance = -2.5  }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_EIA_1 = {
    custom_effect_tooltip = POC_reduce_influence_EIA_1_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -1 }
        add_to_variable = { PCO_usf_Balance = 0.5 }
        add_to_variable = { PCO_ocf_Balance = 0.5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_EIA_2 = {
    custom_effect_tooltip = POC_reduce_influence_EIA_2_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -2 }
        add_to_variable = { PCO_usf_Balance = 1 }
        add_to_variable = { PCO_ocf_Balance = 1 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_EIA_3 = {
    custom_effect_tooltip = POC_reduce_influence_EIA_3_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -5 }
        add_to_variable = { PCO_usf_Balance = 2.5 }
        add_to_variable = { PCO_ocf_Balance = 2.5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}

POC_increase_influence_USF_1 = {
    custom_effect_tooltip = POC_increase_influence_USF_1_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -0.5 }
        add_to_variable = { PCO_usf_Balance = 1 }
        add_to_variable = { PCO_ocf_Balance = -0.5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_increase_influence_USF_2 = {
    custom_effect_tooltip = POC_increase_influence_USF_2_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -1 }
        add_to_variable = { PCO_usf_Balance = 2 }
        add_to_variable = { PCO_ocf_Balance = -1 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_increase_influence_USF_3 = {
    custom_effect_tooltip = POC_increase_influence_USF_3_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -2.5}
        add_to_variable = { PCO_usf_Balance = 5 }
        add_to_variable = { PCO_ocf_Balance = -2.5  }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_USF_1 = {
    custom_effect_tooltip = POC_reduce_influence_USF_1_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = -0.5 }
        add_to_variable = { PCO_usf_Balance = -1 }
        add_to_variable = { PCO_ocf_Balance = 0.5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_USF_2 = {
    custom_effect_tooltip = POC_reduce_influence_USF_2_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 1 }
        add_to_variable = { PCO_usf_Balance = -2 }
        add_to_variable = { PCO_ocf_Balance = 1 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}
POC_reduce_influence_USF_3 = {
    custom_effect_tooltip = POC_reduce_influence_USF_3_TT
    OCF = {
        add_to_variable = { PCO_eia_Balance = 2.5 }
        add_to_variable = { PCO_usf_Balance = -5 }
        add_to_variable = { PCO_ocf_Balance = 2.5 }
        calculate_PenetratingOceanCouncil_XY = yes
    }
}

#军队的警觉度被提高了
#POC_ima_temp
POC_increase_military_alertness = {
    set_temp_variable = { USF_military_alertness_progress_f_temp = global.USF_military_alertness_progress_f }
    add_to_temp_variable = { USF_military_alertness_progress_f_temp = POC_ima_temp }

    if = {
        limit = { check_variable = { USF_military_alertness_progress_f_temp > 100 } }
        set_temp_variable = { USF_military_alertness_progress_f_temp = 100 }
    }
    else_if = {
        limit = { check_variable = { USF_military_alertness_progress_f_temp < 0 } }
        set_temp_variable = { USF_military_alertness_progress_f_temp = 0 }
    }

    if = {
        limit = { check_variable = { POC_ima_temp > 0 } }
        custom_effect_tooltip = POC_increase_military_alertness_1_TT
        add_to_variable = { global.USF_military_alertness_progress_f = POC_ima_temp }
    }
    else = {
        custom_effect_tooltip = POC_increase_military_alertness_2_TT
        add_to_variable = { global.USF_military_alertness_progress_f = POC_ima_temp }
    }

    if = {
        limit = { check_variable = { global.USF_military_alertness_progress_f > 100 } }
        set_variable = { global.USF_military_alertness_progress_f = 100 }
    }
    else_if = {
        limit = { check_variable = { global.USF_military_alertness_progress_f < 0 } }
        set_variable = { global.USF_military_alertness_progress_f = 0 }
    }
}

#议会的渗透度被提高了
#POC_ppi_temp
POC_penetration_parliament_increased = {
    set_temp_variable = { impact_united_states_progress_f_temp = global.impact_united_states_progress_f }
    add_to_temp_variable = { impact_united_states_progress_f_temp = POC_ppi_temp }

    if = {
        limit = { check_variable = { impact_united_states_progress_f_temp > 100 } }
        set_temp_variable = { impact_united_states_progress_f_temp = 100 }
    }
    else_if = {
        limit = { check_variable = { impact_united_states_progress_f_temp < 0 } }
        set_temp_variable = { impact_united_states_progress_f_temp = 0 }
    }

    if = {
        #如果是大洋
        limit = {

            check_variable = { POC_ppi_temp > 0 }
        }
        if = {
            limit = { original_tag = OCF }
            custom_effect_tooltip = POC_penetration_parliament_increased_3_TT
        }
        else = {
            custom_effect_tooltip = POC_penetration_parliament_increased_1_TT
        }

        add_to_variable = { global.impact_united_states_progress_f = POC_ppi_temp }
    }
    else = {
        if = {
            limit = { original_tag = OCF }
            custom_effect_tooltip = POC_penetration_parliament_increased_4_TT
        }
        else = {
            custom_effect_tooltip = POC_penetration_parliament_increased_2_TT
        }
        add_to_variable = { global.impact_united_states_progress_f = POC_ppi_temp }
    }

    if = {
        limit = { check_variable = { global.impact_united_states_progress_f > 100 } }
        set_variable = { global.impact_united_states_progress_f = 100 }
    }
    else_if = {
        limit = { check_variable = { global.impact_united_states_progress_f < 0 } }
        set_variable = { global.impact_united_states_progress_f = 0 }
    }

    set_variable = { global.influence_oceanic_government_progress_f = 100 }
    subtract_from_variable = { global.influence_oceanic_government_progress_f = global.impact_united_states_progress_f }
}



#军队警戒到达阈值
POC_guiding_government_towards = {
    OCF = {
        if = {
            limit = {
                has_global_flag = EIA_contact_vanguard_party_flag
            }
            add_opinion_modifier = {
                target = NAC
                modifier = OCF_support_lotian_low
            }
            NAC = { country_event = { id = USF_OCF_intervention.6 } }
        }
        if = {
            limit = {
                has_global_flag = USF_contact_liberal_party_flag
            }
            add_opinion_modifier = {
                target = USF
                modifier = OCF_support_lotian_low
            }
            USF = { country_event = { id = USF_OCF_intervention.6 } }
        }

    }
    #如果政府倾向外部国家
    if = {
        limit = { POC_ocf_internal_inclination_government = no }
        OCF = { country_event = { id = OCF.54 } }
    }

    #如果政府掌握度过低
    else_if = {
        limit = {
            set_temp_variable = { temp_parliamentary_mastery = 50 }
            USF_parliamentary_mastery_less_than_trigger = yes
        }
        OCF = { country_event = { id = OCF.55 } }
    }

    #无事发生
    else = {
        OCF = { country_event = { id = OCF.56 } }
    }

}