USF_test_line = {
    clear_array = USF_economic_discount_numbers_actual
    add_to_array = { USF_economic_discount_numbers_actual = 62.7 }
    add_to_array = { USF_economic_discount_numbers_actual = 60.9 }
    add_to_array = { USF_economic_discount_numbers_actual = 57.62 }
    add_to_array = { USF_economic_discount_numbers_actual = 55.7 }
    add_to_array = { USF_economic_discount_numbers_actual = 52.1 }
    add_to_array = { USF_economic_discount_numbers_actual = 51.3 }
    USF_calculate_economic_line_chart = yes
}

USF_calculate_economic_line_chart_weekly = {
    set_temp_variable = { temp_stability = usf.stability } #stability 0~1
    multiply_temp_variable = { temp_stability = 100 }
    add_to_array = { USF_economic_discount_numbers_actual = temp_stability }
    remove_from_array = {
        array = USF_economic_discount_numbers_actual
        index = 0
    }
    USF_calculate_economic_line_chart = yes
}

#计算黒沫夜折线图
USF_calculate_economic_line_chart = {
    #查找图表的最大和最小值
    #USF_economic_discount_y_label为y坐标，USF_economic_discount_frame_label是角度
    #USF_economic_discount_numbers存储真数值

    clear_array = USF_economic_discount_numbers
    clear_array = USF_economic_discount_y_label
    clear_array = USF_economic_discount_frame_label
    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers_actual^num
        value = i
        set_temp_variable = { v = USF_economic_discount_numbers_actual^i }
        multiply_temp_variable = { v = 0.72 }
        add_to_array = { USF_economic_discount_numbers = v }
    }
    set_temp_variable = { min = USF_economic_discount_numbers^0 }
    set_temp_variable = { max = USF_economic_discount_numbers^0 }
    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers^num
        value = i
        if = {
            limit = { check_variable = { USF_economic_discount_numbers^i > max } }
            log = "找到了更大的：原：[?max] 现：[?USF_economic_discount_numbers^i]"
            set_temp_variable = { max = USF_economic_discount_numbers^i }
        }
        if = {
            limit = { check_variable = { USF_economic_discount_numbers^i < min } }
            set_temp_variable = { min = USF_economic_discount_numbers^i }
        }
    }

    #随意移动或修改
    #我们的范围是（最小值/1.1）-（最大值*1.1）
    set_temp_variable = { max2 = max }
    multiply_temp_variable = { max = 1.3 }
    set_temp_variable = { min2 = min }
    divide_temp_variable = { min = 1.3 }

    set_temp_variable = { range = max } #范围
    subtract_from_temp_variable = { range = min }
    divide_temp_variable = { range = 50 }

    set_temp_variable = { range2 = max2 } #范围
    subtract_from_temp_variable = { range2 = min2 }
    divide_temp_variable = { range2 = 50 }

    log = "最大值：[?max]"
    log = "最小值：[?min]"
    log = "范围：[?range]"

    #计算新坐标
    clear_array = USF_economic_discount_numbers
    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers_actual^num
        value = i
        set_temp_variable = { v = USF_economic_discount_numbers_actual^i }
        subtract_from_temp_variable = { v = min }
        divide_temp_variable = { v = range }
        add_to_array = { USF_economic_discount_numbers = v }
    }

    for_loop_effect = {
        start = 0
        end = USF_economic_discount_numbers^num
        value = i
        log = "----------第[?i]次计算----------"
        set_temp_variable = { last = i }
        subtract_from_temp_variable = { last = 1 }

        #计算y坐标 要负数
        set_temp_variable = { last_variable = USF_economic_discount_numbers^last }
        log = "上一个数大小为(坐标)：[?last_variable]"
        multiply_temp_variable = { last_variable = -1 }
        # add_to_temp_variable = { last_variable = 90 }
        log = "存入(坐标)：[?last_variable]"
        add_to_array = { USF_economic_discount_y_label = last_variable }

        #计算角度 必须等于（y2-y1）/2+50
        log = "当前角度为：[?USF_economic_discount_numbers^i]"
        set_temp_variable = { current = USF_economic_discount_numbers^i }
        subtract_from_temp_variable = { current = USF_economic_discount_numbers^last }
        log = "减去上一个后角度为：[?current]"
        divide_temp_variable = { current = 2 }
        add_to_temp_variable = { current = 50 }
        log = "最终存入角度为：[?current]"
        add_to_array = { USF_economic_discount_frame_label = current }
    }

    #计算目标线位置 有个偏移y=3
    #y最大是75最小是5 （加上偏移量）

    set_temp_variable = { USF_stable_line_chart_expectation_y_temp = 70 } #目标值
    # multiply_temp_variable = { USF_stable_line_chart_expectation_y_temp = 0.72 } #与上方同等缩小
    subtract_from_temp_variable = { USF_stable_line_chart_expectation_y_temp = min }
    log = "传入目标线y坐标：[?USF_stable_line_chart_expectation_y_temp]"
    divide_temp_variable = { USF_stable_line_chart_expectation_y_temp = range }
    multiply_temp_variable = { USF_stable_line_chart_expectation_y_temp = -1 }
    add_to_temp_variable = { USF_stable_line_chart_expectation_y_temp = 75 }
    set_variable = { USF_stable_line_chart_expectation_y = USF_stable_line_chart_expectation_y_temp }
}


#卡牌测试用
player_slot_machine_numbers_button_debug = {
    for_loop_effect = { #关闭动画
        end = ROOT.player_hand_array^num
        value = var
        set_variable = { ROOT.player_hand_array_animation^var = 0 }
    }

    if = {
        limit = { check_variable = { ROOT.player_hand_array^num < 8 } }
        # if = {
        #     limit = { check_variable = { player_hand_button_1_update = 0 } }
        #     set_variable = { player_hand_button_1_update = 1 }
        # }
        add_to_array = { ROOT.player_hand_array_animation = 801000 }
        add_to_array = { ROOT.player_hand_array_x = 300 }

        # add_to_variable = { player_hand_button_1_update = 1 }
        # if = {
        #     limit = {
        #         check_variable = { player_hand_button_1_update = 2 }
        #     }
        #     set_variable = { player_hand_button_1_update = 0 }
        # }
        meta_effect = {
            text = {
                add_to_variable = { ROOT.player_hand_button_[V]_update = 1 }
                modulo_variable = { ROOT.player_hand_button_[V]_update = 2 }
            }
            V = "[?ROOT.player_hand_array^num]"
        }
    }
    else = {
        clear_array = ROOT.player_hand_array_animation
        clear_array = ROOT.player_hand_array
        clear_array = ROOT.player_hand_array_x
    }

    for_loop_effect = { #关闭动画
        end = ROOT.player_hand_array^num
        value = var
        log = "ROOT.player_hand_array_animation^[?var]=[?ROOT.player_hand_array_animation^var]"
    }
    log = "ROOT.player_hand_array^num=[?ROOT.player_hand_array^num]"
    log = "ROOT.player_hand_array_animation^num=[?ROOT.player_hand_array_animation^num]"
    log = "ROOT.player_hand_array_x^num=[?ROOT.player_hand_array_x^num]"
    log = "卡牌动画启用数值=[?player_hand_button_1_update]"




    # set_variable = { ROOT.player_hand_array_animation^0 = 401010 }

    # clear_array = ROOT.player_hand_array_animation
    # clear_array = ROOT.player_hand_array
    # clear_array = ROOT.player_hand_array_x




    ########################################

    add_to_variable = { USF_player_slot_machine_numbers_icon_1_update = 1 }
    if = {
        limit = {
            check_variable = { USF_player_slot_machine_numbers_icon_1_update = 2 }
        }
        set_variable = { USF_player_slot_machine_numbers_icon_1_update = 0 }
    }
    add_to_variable = { USF_player_promotion_coefficient_numbers_icon_1_update = 1 }
    if = {
        limit = {
            check_variable = { USF_player_promotion_coefficient_numbers_icon_1_update = 2 }
        }
        set_variable = { USF_player_promotion_coefficient_numbers_icon_1_update = 0 }
    }
    add_to_variable = { USF_player_public_opinion_progress_bar_g_update = 1 }
    if = {
        limit = {
            check_variable = { USF_player_public_opinion_progress_bar_g_update = 2 }
        }
        set_variable = { USF_player_public_opinion_progress_bar_g_update = 0 }
    }


    # set_variable_to_random = {
    #     var = USF_player_slot_machine_numbers_icon_1_random
    #     max = 999
    #     min = 100
    #     integer = yes
    # }
    # multiply_temp_variable = { USF_player_slot_machine_numbers_icon_1_random = 100 }
    # set_variable = { USF_player_slot_machine_numbers_icon_1_random_v = USF_player_slot_machine_numbers_icon_1_random }
    # log = "[?USF_player_slot_machine_numbers_icon_1_random_v]"
    if = {
        limit = {
            OR = {
                check_variable = { USF_player_slot_machine_numbers_icon_1_random = 0 }
                check_variable = { USF_player_slot_machine_numbers_icon_1_random = 53047 }
            }
        }
        set_variable = { USF_player_slot_machine_numbers_icon_1_random = 47053 }
    }
    else = {
        set_variable = { USF_player_slot_machine_numbers_icon_1_random = 53047 }
    }
    if = {
        limit = {
            OR = {
                check_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 0 }
                check_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 9000 }
            }
        }
        set_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 9 }
    }
    else = {
        set_variable = { USF_player_promotion_coefficient_numbers_icon_1_random = 9000 }
    }
    if = {
        limit = {
            OR = {
                check_variable = { USF_player_public_opinion_progress_bar_g_random = 0 }
                check_variable = { USF_player_public_opinion_progress_bar_g_random = 50080 }
            }
        }
        set_variable = { USF_player_public_opinion_progress_bar_g_random = 80050 }
    }
    else = {
        set_variable = { USF_player_public_opinion_progress_bar_g_random = 50080 }
    }



    #测试 删除所有出牌
    clear_array = ROOT.player_play_area_array
    clear_array = ROOT.player_play_area_array_animation
    clear_array = ROOT.player_play_area_hole_array
    clear_array = ROOT.player_play_area_hole_array_animation

    #增加手牌次数
    set_variable = { player_exposed_small_hand = 1 }
    set_variable = { player_unfaced_small_hand = 1 }
}


#卡牌打出动画结束后更新手牌位置
USF_update_player_hand_position_after_animation = {
    set_variable = { ROOT.player_hand_array_animation^frame_temp = 501000 }
    set_variable = { ROOT.player_hand_array_x^frame_temp = 0 }

    for_loop_effect = {
        end = ROOT.player_hand_array^num
        value = var
        # log = "player_hand_array_i=[?var]"
        if = {
            limit = { check_variable = { frame_temp < var } }
            # log = "player_hand_array_i<var，修改一格动画"
            set_variable = { ROOT.player_hand_array_animation^var = 141000 }
            meta_effect = {
                text = {
                    add_to_variable = { ROOT.player_hand_button_[V]_update = 1 }
                    modulo_variable = { ROOT.player_hand_button_[V]_update = 2 }
                }
                V = "[?var]"
            }
        }
        # else = {
        #     # log = "player_hand_array_i>var，删除动画"
        #     set_variable = { ROOT.player_hand_array_animation^var = 0 }
        # }
    }

    # add_to_variable = { player_hand_button_1_update = 1 }
    # if = {
    #     limit = {
    #         check_variable = { player_hand_button_1_update = 2 }
    #     }
    #     set_variable = { player_hand_button_1_update = 0 }
    # }

    if = {
        limit = {
            check_variable = { ROOT.player_hand_array^frame_temp = 1 }
            check_variable = { ROOT.player_exposed_small_hand > 0 }
        }
        USF_player_play_area_card_issuing = yes

        remove_from_array = {
            array = ROOT.player_hand_array
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_animation
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_x
            index = frame_temp
        }
    }
    else_if = {
        limit = {
            check_variable = { ROOT.player_unfaced_small_hand > 0 }
            OR = {
                check_variable = { ROOT.player_hand_array^frame_temp = 2 }
                check_variable = { ROOT.player_hand_array^frame_temp = 3 }
                check_variable = { ROOT.player_hand_array^frame_temp = 4 }
                check_variable = { ROOT.player_hand_array^frame_temp = 5 }
            }
        }
        USF_player_play_area_card_issuing_hole = yes

        remove_from_array = {
            array = ROOT.player_hand_array
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_animation
            index = frame_temp
        }
        remove_from_array = {
            array = ROOT.player_hand_array_x
            index = frame_temp
        }
    }
    else = {
        #清除所有手牌移动动画
        for_loop_effect = {
            end = ROOT.player_hand_array^num
            value = var
            set_variable = { ROOT.player_hand_array_animation^var = 0 }
        }
    }

    set_variable = { player_hand_array_output = frame_temp }
    log = "卡牌动画启用数值=[?player_hand_button_1_update]"
}


#打出卡牌
USF_player_play_area_card_issuing = {
    add_to_variable = { player_exposed_small_hand = -1 }
    add_to_variable = { ROOT.player_play_area_icon_update = 1 }
    if = {
        limit = {
            check_variable = { ROOT.player_play_area_icon_update = 2 }
        }
        set_variable = { ROOT.player_play_area_icon_update = 0 }
    }

    #清空动画
    for_loop_effect = {
        end = ROOT.player_play_area_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_array_animation^var = 0 }
    }
    for_loop_effect = {
        end = ROOT.player_play_area_hole_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_hole_array_animation^var = 0 }
    }

    #存入卡组
    add_to_array = { ROOT.player_play_area_array = ROOT.player_hand_array^frame_temp }

    #播放出牌动画######################
    #判定出牌位置 如果第一张牌 出卡槽一 输入2 如果是1，则不播放
    # set_temp_variable = { card_slot_insertion_point = ROOT.player_play_area_array^num }
    if = {
        limit = { check_variable = { ROOT.player_play_area_array^num = 1 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 2 }
        add_to_array = { ROOT.player_play_area_array_animation = card_slot_insertion_point_animation_temp }
    }
    else_if = {
        limit = { check_variable = { ROOT.player_play_area_array^num = 2 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 9 }
        add_to_array = { ROOT.player_play_area_array_animation = card_slot_insertion_point_animation_temp }
    }
    else_if = {
        limit = { check_variable = { ROOT.player_play_area_array^num = 3 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 16 }
        add_to_array = { ROOT.player_play_area_array_animation = card_slot_insertion_point_animation_temp }
    }
}

#打出卡牌 暗牌
USF_player_play_area_card_issuing_hole = {
    add_to_variable = { player_unfaced_small_hand = -1 }
    add_to_variable = { ROOT.player_play_area_icon_update = 1 }
    if = {
        limit = {
            check_variable = { ROOT.player_play_area_icon_update = 2 }
        }
        set_variable = { ROOT.player_play_area_icon_update = 0 }
    }

    #清空动画
    for_loop_effect = {
        end = ROOT.player_play_area_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_array_animation^var = 0 }
    }
    for_loop_effect = {
        end = ROOT.player_play_area_hole_array_animation^num
        value = var
        set_variable = { ROOT.player_play_area_hole_array_animation^var = 0 }
    }

    #存入卡组
    add_to_array = { ROOT.player_play_area_hole_array = ROOT.player_hand_array^frame_temp }

    #播放出牌动画######################
    #判定出牌位置 如果第一张牌 出卡槽一 输入2 如果是1，则不播放
    if = {
        limit = { check_variable = { ROOT.player_play_area_hole_array^num = 1 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 23 }
        add_to_array = { ROOT.player_play_area_hole_array_animation = card_slot_insertion_point_animation_temp }
    }
    else_if = {
        limit = { check_variable = { ROOT.player_play_area_hole_array^num = 2 } }
        set_temp_variable = { card_slot_insertion_point_animation_temp = frame_temp }
        add_to_temp_variable = { card_slot_insertion_point_animation_temp = 30 }
        add_to_array = { ROOT.player_play_area_hole_array_animation = card_slot_insertion_point_animation_temp }
    }
}