STG_unrest_change = {
    STG = {
        if = {
            limit = {
                NOT = {
                    has_country_flag = STG_cam_crushed
                }
            }
            add_to_variable = {STG_cam_unrest = 0.5}
        }
        if = {
            limit = {
                NOT = {
                    has_country_flag = STG_usr_crushed
                }
            }
            add_to_variable = {STG_usr_unrest = 0.5}
        }
    }
}
#检测卡美洛派威胁
STG_check_cam_unrest = {
    if = {
        limit = {
            has_country_flag = STG_cam_crushed
        }
        STG = {
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            remove_ideas = STG_cam_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest < 10}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            add_ideas = STG_cam_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest > 20}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            add_ideas = STG_cam_discontent_middle
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest > 40}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_very_high
            add_ideas = STG_cam_discontent_high
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest > 60}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            add_ideas = STG_cam_discontent_very_high
        }
    }
}
#检测乌斯拉尔裔威胁
STG_check_usr_unrest = {
    if = {
        limit = {
            has_country_flag = STG_usr_crushed
        }
        STG = {
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            remove_ideas = STG_usr_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest < 10}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            add_ideas = STG_usr_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest > 20}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            add_ideas = STG_usr_discontent_middle
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest > 40}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_very_high
            add_ideas = STG_usr_discontent_high
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest > 60}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            add_ideas = STG_usr_discontent_very_high
        }
    }
}
#安抚乌斯拉尔裔
STG_reduce_usr_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_usr_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = -5}}
            STG_check_usr_unrest = yes
        }
    }
}
#安抚乌斯拉尔裔-大
STG_reduce_usr_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_usr_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = -10}}
            STG_check_usr_unrest = yes
        }
    }
}
#激怒乌斯拉尔裔
STG_increase_usr_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_increase_usr_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = 5}}
            STG_check_usr_unrest = yes
        }
    }
}
#激怒乌斯拉尔裔-大
STG_increase_usr_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_increase_usr_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = 10}}
            STG_check_usr_unrest = yes
        }
    }
}
#打击卡美洛派
STG_reduce_cam_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_cam_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = -5}}
            STG_check_cam_unrest = yes
        }
    }
}
#打击卡美洛派-大
STG_reduce_cam_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_cam_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = -10}}
            STG_check_cam_unrest = yes
        }
    }
}
#激怒卡美洛派
STG_increase_cam_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_increase_cam_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = 5}}
            STG_check_cam_unrest = yes
        }
    }
}
#激怒卡美洛派-大
STG_increase_cam_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_increase_cam_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = 10}}
            STG_check_cam_unrest = yes
        }
    }
}
#初始化
STG_gov_stability_setup = {
    STG = {
        set_variable = {STG_gov_stability_limit_base = 70}#阈值 基础值，不可变动，其他修正写在 bonus或者modifier里头
        #政权稳定没有均衡点

        #昂格利亚裔
        set_variable = {STG_anglian_opinion = 55}
        set_variable = {STG_anglian_opinion_limit_base = 80}#基础值，不可变动，其他修正写在 bonus或者modifier里头
        set_variable = {STG_anglian_opinion_equilibrium_base = 50}#基础值，不可变动，其他修正写在 bonus或者modifier里头
        #乌斯拉尔裔
        set_variable = {STG_uslarian_opinion = 50}
        set_variable = {STG_uslarian_opinion_limit_base = 75}#基础值，不可变动，其他修正写在 bonus或者modifier里头
        set_variable = {STG_uslarian_opinion_equilibrium_base = 50}#基础值，不可变动，其他修正写在 bonus或者modifier里头
        #军队不满
        set_variable = { STG_army_discontent = 40 } 
        #卡美洛效忠派威胁
        set_variable = { STG_cam_unrest = 10 } 
        #乌斯拉尔裔不满
        set_variable = { STG_usr_unrest = 15 } 
        #议会席位
        set_variable = { STG_seats = 30 } 
        #支持票
        set_variable = { STG_supporter = 18 } 
        #通过法案需求
        set_variable = { STG_supporter_needed = 20 } 
        #工团修正
        set_variable = {STG_rev_production_speed_buildings_factor = 0.10}
        set_variable = {STG_rev_industrial_capacity_factory = 0.05}
        set_variable = {STG_production_factory_max_efficiency_factor = 0.05}

        #向均衡点回归速率
        set_variable = {R = 0.05}

        add_dynamic_modifier = {modifier = STG_gov_stability_modifier}
    }
}
#计算所有的阈值和均衡
STG_refresh_all_limit_and_equilibrium = {
    STG = {
        set_variable = {STG_gov_stability_limit = 0}
        add_to_variable = {STG_gov_stability_limit = STG_gov_stability_limit_base}
        add_to_variable = {STG_gov_stability_limit = STG_gov_stability_limit_bonus}
        add_to_variable = {STG_gov_stability_limit = modifier@STG_gov_stability_limit_modifier}
        log = "STG政权稳定上限：基础[?STG_gov_stability_limit_base]，奖励[?STG_gov_stability_limit_bonus]，修正[?modifier@STG_gov_stability_limit_modifier]"
        
        clamp_variable = {
            var = STG_gov_stability_limit
            min = 0 
            max = 100
        }
        clamp_variable = {
            var = STG_gov_stability
            min = 0 
            max = STG_gov_stability_limit
        }

        set_variable = {STG_anglian_opinion_limit = 0}
        add_to_variable = {STG_anglian_opinion_limit = STG_anglian_opinion_limit_base}
        add_to_variable = {STG_anglian_opinion_limit = STG_anglian_opinion_limit_bonus}
        add_to_variable = {STG_anglian_opinion_limit = modifier@STG_anglian_opinion_limit_modifier}
        log = "STG昂格利亚裔好感上限：基础[?STG_anglian_opinion_limit_base]，奖励[?STG_anglian_opinion_limit_bonus]，修正[?modifier@STG_anglian_opinion_limit_modifier]"

        clamp_variable = {
            var = STG_anglian_opinion_limit
            min = 0 
            max = 100
        }
        clamp_variable = {
            var = STG_anglian_opinion
            min = 0 
            max = STG_anglian_opinion_limit
        }

        set_variable = {STG_anglian_opinion_equilibrium = 0}
        add_to_variable = {STG_anglian_opinion_equilibrium = STG_anglian_opinion_equilibrium_base}
        add_to_variable = {STG_anglian_opinion_equilibrium = STG_anglian_opinion_equilibrium_bonus}
        add_to_variable = {STG_anglian_opinion_equilibrium = modifier@STG_anglian_opinion_equilibrium_modifier}
        log = "STG昂格利亚裔好感均衡：基础[?STG_anglian_opinion_equilibrium_base]，奖励[?STG_anglian_opinion_equilibrium_bonus]，修正[?modifier@STG_anglian_opinion_equilibrium_modifier]"

        set_variable = {STG_uslarian_opinion_limit = 0}
        add_to_variable = {STG_uslarian_opinion_limit = STG_uslarian_opinion_limit_base}
        add_to_variable = {STG_uslarian_opinion_limit = STG_uslarian_opinion_limit_bonus}
        add_to_variable = {STG_uslarian_opinion_limit = modifier@STG_uslarian_opinion_limit_modifier}
        log = "STG乌斯拉尔裔好感上限：基础[?STG_uslarian_opinion_limit_base]，奖励[?STG_uslarian_opinion_limit_bonus]，修正[?modifier@STG_uslarian_opinion_limit_modifier]"

        clamp_variable = {
            var = STG_uslarian_opinion_limit
            min = 0 
            max = 100
        }
        clamp_variable = {
            var = STG_uslarian_opinion
            min = 0 
            max = STG_uslarian_opinion_limit
        }

        set_variable = {STG_uslarian_opinion_equilibrium = 0}
        add_to_variable = {STG_uslarian_opinion_equilibrium = STG_uslarian_opinion_equilibrium_base}
        add_to_variable = {STG_uslarian_opinion_equilibrium = STG_uslarian_opinion_equilibrium_bonus}
        add_to_variable = {STG_uslarian_opinion_equilibrium = modifier@STG_uslarian_opinion_equilibrium_modifier}
        log = "STG乌斯拉尔裔好感均衡：基础[?STG_uslarian_opinion_equilibrium_base]，奖励[?STG_uslarian_opinion_equilibrium_bonus]，修正[?modifier@STG_uslarian_opinion_equilibrium_modifier]"
    }   
}
#政权稳定度计算
STG_refresh_gov_stability = {
    hidden_effect = {
        STG = {
            set_variable = {STG_gov_stability = 0}
            #优先计算上限
            STG_refresh_all_limit_and_equilibrium = yes

            if = {
                limit = {
                    check_variable = {var = STG_anglian_opinion value = STG_uslarian_opinion compare = greater_than_or_equals}
                }
                set_variable = {STG_gov_stability_1 = STG_anglian_opinion}
                set_variable = {STG_gov_stability_2 = STG_uslarian_opinion}
            }
            else = {
                set_variable = {STG_gov_stability_2 = STG_anglian_opinion}
                set_variable = {STG_gov_stability_1 = STG_uslarian_opinion}
            }
            set_variable = {STG_gov_stability_3 = STG.stability}
            set_variable = {STG_gov_stability_4 = STG_army_discontent}
            add_to_variable = {STG_gov_stability_4 = -50}
            if = {
                limit = {
                    has_government = democratic
                }
                set_variable = {STG_gov_stability_5 = STG.party_popularity@democratic}
            }
            else_if = {
                limit = {
                    has_government = neutrality
                }
                set_variable = {STG_gov_stability_5 = STG.party_popularity@neutrality}
            }
            else_if = {
                limit = {
                    has_government = communism
                }
                set_variable = {STG_gov_stability_5 = STG.party_popularity@communism}
            }
            else = {
                set_variable = {STG_gov_stability_5 = 0}
            }
            if = {
                limit = {
                    has_country_flag = STG_rev_national_security
                }
                set_variable = {STG_gov_stability_6 = STG_rev_national_security}
                multiply_variable = {STG_gov_stability_6 = 0.5}
            }

            set_variable = {STG_gov_stability_1_t = STG_gov_stability_1}
            set_variable = {STG_gov_stability_2_t = STG_gov_stability_2}
            set_variable = {STG_gov_stability_3_t = STG_gov_stability_3}
            set_variable = {STG_gov_stability_4_t = STG_gov_stability_4}
            set_variable = {STG_gov_stability_5_t = STG_gov_stability_5}
            set_variable = {STG_gov_stability_6_t = STG_gov_stability_6}
            #政权稳定度公式（非红线）：0.15*max(昂格利亚好感，乌斯拉尔好感)+0.25*min(昂格利亚好感，乌斯拉尔好感)+0.1*稳定度-0.25*（军队不满度-50）+0.15*当前执政派系饼图     if <= 阈值
            if = {
                limit = {
                    NOT = {has_country_flag = STG_rev_national_security}
                }
                multiply_variable = {STG_gov_stability_1_t = 0.15}
                add_to_variable = {STG_gov_stability = STG_gov_stability_1_t}
                multiply_variable = {STG_gov_stability_2_t = 0.25}
                add_to_variable = {STG_gov_stability = STG_gov_stability_2_t}
                multiply_variable = {STG_gov_stability_3_t = 0.1}
                add_to_variable = {STG_gov_stability = STG_gov_stability_3_t}
                multiply_variable = {STG_gov_stability_4_t = -0.25}
                add_to_variable = {STG_gov_stability = STG_gov_stability_4_t}
                multiply_variable = {STG_gov_stability_5_t = 0.15}
                add_to_variable = {STG_gov_stability = STG_gov_stability_5_t}
            }
            #政权稳定度公式（红线）：0.1*max(昂格利亚好感，乌斯拉尔好感)+0.15*min(昂格利亚好感，乌斯拉尔好感)+0.15*稳定度-0.1 *（军队不满度-50）+0.2*当前执政派系饼图+0.3*(国内安全值/2) if <= 阈值
            else = {
                multiply_variable = {STG_gov_stability_1_t = 0.1}
                add_to_variable = {STG_gov_stability = STG_gov_stability_1_t}
                multiply_variable = {STG_gov_stability_2_t = 0.15}
                add_to_variable = {STG_gov_stability = STG_gov_stability_2_t}
                multiply_variable = {STG_gov_stability_3_t = 0.15}
                add_to_variable = {STG_gov_stability = STG_gov_stability_3_t}
                multiply_variable = {STG_gov_stability_4_t = -0.1}
                add_to_variable = {STG_gov_stability = STG_gov_stability_4_t}
                multiply_variable = {STG_gov_stability_5_t = 0.2}
                add_to_variable = {STG_gov_stability = STG_gov_stability_5_t}
                multiply_variable = {STG_gov_stability_6_t = 0.3}
                add_to_variable = {STG_gov_stability = STG_gov_stability_6_t}
            }
            add_to_variable = {STG_gov_stability = modifier@STG_gov_stability_bonus_modiifer}

            clamp_variable = {
                var = STG_gov_stability
                min = 0
                max = STG_gov_stability_limit
            }
        }
        STG_refresh_gov_stability_modifier = yes
    }
}

#刷新动态修正
STG_refresh_gov_stability_modifier = {
    hidden_effect = {
        set_variable = {STG_gov_stability_d = STG_gov_stability}
        set_variable = {STG_anglian_opinion_d = STG_anglian_opinion}
        set_variable = {STG_uslarian_opinion_d = STG_uslarian_opinion}
        add_to_variable = {STG_gov_stability_d = -50}
        add_to_variable = {STG_anglian_opinion_d = -50}
        add_to_variable = {STG_uslarian_opinion_d = -50}

        set_variable = {STG_gov_stability_factor_t = 0.005}
        set_variable = {STG_gov_war_support_factor_t = 0.004}
        set_variable = {STG_gov_production_factory_max_efficiency_factor_t = 0.002}
        set_variable = {STG_gov_industrial_capacity_factory_t = 0.001}
        set_variable = {STG_gov_industrial_capacity_dockyard_t = 0.001}
        set_variable = {STG_gov_consumer_goods_factor_t = -0.003}
        set_variable = {STG_gov_conscription_factor_t = 0.005}
        set_variable = {STG_gov_army_core_attack_factor_t = 0.002}
        set_variable = {STG_gov_army_core_defence_factor_t = 0.002}
        set_variable = {STG_gov_production_speed_buildings_factor_t = 0.002}

        set_variable = {STG_gov_stability_factor = STG_gov_stability_factor_t}
        set_variable = {STG_gov_war_support_factor = STG_gov_war_support_factor_t}
        set_variable = {STG_gov_production_factory_max_efficiency_factor = STG_gov_production_factory_max_efficiency_factor_t}
        set_variable = {STG_gov_industrial_capacity_factory = STG_gov_industrial_capacity_factory_t}
        set_variable = {STG_gov_industrial_capacity_dockyard = STG_gov_industrial_capacity_dockyard_t}
        set_variable = {STG_gov_consumer_goods_factor = STG_gov_consumer_goods_factor_t}
        set_variable = {STG_gov_conscription_factor = STG_gov_conscription_factor_t}
        set_variable = {STG_gov_army_core_attack_factor = STG_gov_army_core_attack_factor_t}
        set_variable = {STG_gov_army_core_defence_factor = STG_gov_army_core_defence_factor_t}
        set_variable = {STG_gov_production_speed_buildings_factor = STG_gov_production_speed_buildings_factor_t}

        multiply_variable = {STG_gov_stability_factor = STG_gov_stability_d}
        multiply_variable = {STG_gov_war_support_factor = STG_gov_stability_d}
        multiply_variable = {STG_gov_production_factory_max_efficiency_factor = STG_gov_stability_d}
        multiply_variable = {STG_gov_industrial_capacity_factory = STG_anglian_opinion_d}
        multiply_variable = {STG_gov_industrial_capacity_dockyard = STG_anglian_opinion_d}
        multiply_variable = {STG_gov_consumer_goods_factor = STG_anglian_opinion_d}
        multiply_variable = {STG_gov_conscription_factor = STG_uslarian_opinion_d}
        multiply_variable = {STG_gov_army_core_attack_factor = STG_uslarian_opinion_d}
        multiply_variable = {STG_gov_army_core_defence_factor = STG_uslarian_opinion_d}
        multiply_variable = {STG_gov_production_speed_buildings_factor = STG_uslarian_opinion_d}
    }
}

#数值向均衡点回归
STG_data_approach_eq = {
    #回归值 = （当前-均衡）*回归速率
    STG = {
        #先刷新均衡和上限再计算回归
        STG_refresh_all_limit_and_equilibrium = yes
        set_variable = {STG_gov_stability_delta = 0}
        set_variable = {STG_anglian_opinion_delta = 0}
        set_variable = {STG_uslarian_opinion_delta = 0}

        set_variable = {STG_gov_stability_current = STG_gov_stability}
        set_variable = {STG_gov_stability_target = STG_gov_stability_equilibrium}
        subtract_from_variable = {STG_gov_stability_target = STG_gov_stability_current}
        set_variable = {STG_gov_stability_delta = STG_gov_stability_target}
        multiply_variable = {STG_gov_stability_delta = R}

        log = "STG当前政权稳定：[?STG_gov_stability]"
        log = "STG当前政权稳定均衡：[?STG_gov_stability_equilibrium]"
        log = "STG本周政权稳定向均衡点变化：[?STG_gov_stability_delta]"

        add_to_variable = {STG_gov_stability = STG_gov_stability_delta}

        set_variable = {STG_anglian_opinion_current = STG_anglian_opinion}
        set_variable = {STG_anglian_opinion_target = STG_anglian_opinion_equilibrium}
        subtract_from_variable = {STG_anglian_opinion_target = STG_anglian_opinion_current}
        set_variable = {STG_anglian_opinion_delta = STG_anglian_opinion_target}
        multiply_variable = {STG_anglian_opinion_delta = R}

        log = "STG当前昂格利亚好感：[?STG_anglian_opinion]"
        log = "STG当前昂格利亚好感均衡：[?STG_anglian_opinion_equilibrium]"
        log = "STG本周昂格利亚好感向均衡点变化：[?STG_anglian_opinion_delta]"

        add_to_variable = {STG_anglian_opinion = STG_anglian_opinion_delta}

        set_variable = {STG_uslarian_opinion_current = STG_uslarian_opinion}
        set_variable = {STG_uslarian_opinion_target = STG_uslarian_opinion_equilibrium}
        subtract_from_variable = {STG_uslarian_opinion_target = STG_uslarian_opinion_current}
        set_variable = {STG_uslarian_opinion_delta = STG_uslarian_opinion_target}
        multiply_variable = {STG_uslarian_opinion_delta = R}

        log = "STG当前乌斯拉尔好感：[?STG_uslarian_opinion]"
        log = "STG当前乌斯拉尔好感均衡：[?STG_uslarian_opinion_equilibrium]"
        log = "STG本周乌斯拉尔好感向均衡点变化：[?STG_uslarian_opinion_delta]"

        add_to_variable = {STG_uslarian_opinion = STG_uslarian_opinion_delta}

        STG_refresh_gov_stability = yes
    }
}
STG_change_gov_stability_limit = {
    custom_effect_tooltip = STG_change_gov_stability_limit_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_gov_stability_limit_bonus = STG_gov_stability_limit_bonus_temp}
            STG_refresh_all_limit_and_equilibrium = yes
        }
    }
}
STG_change_anglian_opinion = {
    custom_effect_tooltip = STG_change_anglian_opinion_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_anglian_opinion = STG_anglian_opinion_temp}
            STG_refresh_gov_stability = yes
        }
    }
}
STG_change_anglian_opinion_limit = {
    custom_effect_tooltip = STG_change_anglian_opinion_limit_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_anglian_opinion_limit_bonus = STG_anglian_opinion_limit_bonus_temp}
            STG_refresh_all_limit_and_equilibrium = yes
        }
    }
}
STG_change_anglian_opinion_equilibrium = {
    custom_effect_tooltip = STG_change_anglian_opinion_equilibrium_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_anglian_opinion_equilibrium_bonus = STG_anglian_opinion_equilibrium_bonus_temp}
            STG_refresh_all_limit_and_equilibrium = yes
        }
    }
}
STG_change_uslarian_opinion = {
    custom_effect_tooltip = STG_change_uslarian_opinion_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_uslarian_opinion = STG_uslarian_opinion_temp}
            STG_refresh_gov_stability = yes
        }
    }
}
STG_change_uslarian_opinion_limit = {
    custom_effect_tooltip = STG_change_uslarian_opinion_limit_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_uslarian_opinion_limit_bonus = STG_uslarian_opinion_limit_bonus_temp}
            STG_refresh_all_limit_and_equilibrium = yes
        }
    }
}
STG_change_uslarian_opinion_equilibrium = {
    custom_effect_tooltip = STG_change_uslarian_opinion_equilibrium_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_uslarian_opinion_equilibrium_bonus = STG_uslarian_opinion_equilibrium_bonus_temp}
            STG_refresh_all_limit_and_equilibrium = yes
        }
    }
}
STG_army_discontent_change = {
    custom_effect_tooltip = STG_army_discontent_change_desc
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    NOT = {has_country_flag = STG_disable_the_sword_of_Damocles_decisions}
                }
                if = {
                    limit = {
                        check_variable = {STG_gov_stability < 10}
                    }
                    add_to_variable = {STG_army_discontent = 1}
                }
                else_if = {
                    limit = {
                        check_variable = {var = STG_gov_stability value = 10 compare = greater_than_or_equals}
                        check_variable = {STG_gov_stability < 20}
                    }
                    add_to_variable = {STG_army_discontent = 0.8}
                }
                else_if = {
                    limit = {
                        check_variable = {var = STG_gov_stability value = 20 compare = greater_than_or_equals}
                        check_variable = {STG_gov_stability < 30}
                    }
                    add_to_variable = {STG_army_discontent = 0.6}
                }
                else_if = {
                    limit = {
                        check_variable = {var = STG_gov_stability value = 30 compare = greater_than_or_equals}
                        check_variable = {STG_gov_stability < 40}
                    }
                    add_to_variable = {STG_army_discontent = 0.4}
                }
                else_if = {
                    limit = {
                        check_variable = {var = STG_gov_stability value = 40 compare = greater_than_or_equals}
                        check_variable = {STG_gov_stability < 50}
                    }
                    add_to_variable = {STG_army_discontent = 0.2}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_gov_stability > 50}
                        check_variable = {var = STG_gov_stability value = 60 compare = less_than_or_equals}
                    }
                    add_to_variable = {STG_army_discontent = -0.1}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_gov_stability > 60}
                        check_variable = {var = STG_gov_stability value = 70 compare = less_than_or_equals}
                    }
                    add_to_variable = {STG_army_discontent = -0.2}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_gov_stability > 70}
                        check_variable = {var = STG_gov_stability value = 80 compare = less_than_or_equals}
                    }
                    add_to_variable = {STG_army_discontent = -0.3}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_gov_stability > 80}
                        check_variable = {var = STG_gov_stability value = 90 compare = less_than_or_equals}
                    }
                    add_to_variable = {STG_army_discontent = -0.4}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_gov_stability > 90}
                    }
                    add_to_variable = {STG_army_discontent = -0.5}
                }
                STG_check_army_discontent = yes
            }
        }
    }
}
#检测军队不满
STG_check_army_discontent = {
    STG = {
        clamp_variable = {
            var = STG_army_discontent
            max = 100
            min = 0
        }
        STG_refresh_gov_stability = yes
    }
}
#减少军队不满
STG_reduce_army_discontent = {
    custom_effect_tooltip = STG_reduce_army_discontent_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = -5}}
        STG_check_army_discontent = yes
    }
}
#减少军队不满-大
STG_reduce_army_discontent_big = {
    custom_effect_tooltip = STG_reduce_army_discontent_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = -10}}
        STG_check_army_discontent = yes
    }
}
#减少军队不满-大
STG_reduce_army_discontent_15 = {
    custom_effect_tooltip = STG_reduce_army_discontent_15_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = -15}}
        STG_check_army_discontent = yes
    }
}
#增加军队不满
STG_increase_army_discontent = {
    custom_effect_tooltip = STG_increase_army_discontent_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = 5}}
        STG_check_army_discontent = yes
    }
}
#增加军队不满-大
STG_increase_army_discontent_big = {
    custom_effect_tooltip = STG_increase_army_discontent_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = 10}}
        STG_check_army_discontent = yes
    }
}
STG_change_supporter = {
    custom_effect_tooltip = STG_change_supporter_desc
    hidden_effect = {
        add_to_variable = {STG_supporter = STG_supporter_temp}
        STG_check_supporters = yes
    }
}
#检测支持
STG_check_supporters = {
    if = {
        limit = {
            has_country_flag = STG_ilya_issue_1_passed

        }
        clamp_variable = {
            var = STG_supporter
            max = 33
            min = 0
        }
    }
    else = {
        clamp_variable = {
            var = STG_supporter
            max = 30
            min = 0
        }
    }

}
#设定为USR傀儡
STG_became_USR_puppet = {
    STG = {
        set_country_flag = STG_is_usr_puppet
        add_stability = -0.20
        add_war_support = -0.20
        add_manpower = -25000
        set_politics = {
            ruling_party = fascism
        }
        promote_character = {
            character = STG_BF109
            ideology = sub_Facism
        }
        add_popularity = {
            ideology = fascism
            popularity = 0.15
        }
        country_lock_all_division_template = no
        delete_unit_template_and_units = {
            division_template = "St. Gloriana Tank Division"
            disband = no
        }
        delete_unit_template_and_units = {
            division_template = "National Guard"
            disband = no
        }
        set_country_flag = STG_disable_internal_ememy_decisions
        set_country_flag = STG_disable_parliament_issues_decisions
        STG_clear_state_flag = yes
        set_variable = {STG_army_discontent = 0}
        set_country_flag = STG_disable_the_sword_of_Damocles_decisions
        set_country_flag = disallow_stg_leaders
        set_cosmetic_tag = STG_usr_subject_fascism
        if = {
            limit = {
                MYK = {
                    is_puppet_of = STG
                }
            }
            USR = {
                set_autonomy = {
                    target = MYK
                    autonomy_state = autonomy_puppet
                }
            }
        }
        hidden_effect = {
            if = {
                limit = {
                    has_global_flag = ANGLIA_RECONCLIATION_FLAG
                }
                remove_opinion_modifier = {
                    target = FNG
                    modifier = Anglia_Reconcilation
                }
                diplomatic_relation = {
                    country = FNG
                    relation = guarantee
                    active = no
                }
                FNG = {
                    diplomatic_relation = {
                        country = STG
                        relation = guarantee
                        active = no
                    }
                    remove_opinion_modifier = {
                        target = STG
                        modifier = Anglia_Reconcilation
                    }
                }
            }
            country_event = {id = STG_civ_war.1 days = 250}
            news_event = {id = STG_news.11 days = 3}
            remove_power_balance = {id = STG_centralized_vs_decentralized}
            load_focus_tree = {
                tree = STG_USR_puppet_focus
                keep_completed = yes
            }
            mark_focus_tree_layout_dirty = yes
            remove_ideas = STG_home_of_industralist
            remove_ideas = STG_fort_of_industralist
            remove_ideas = STG_heaven_of_industralist
            remove_ideas = STG_full_of_corruption
            remove_ideas = STG_darjeeling_leader
            remove_ideas = STG_orange_pekoe_leader
            remove_ideas = STG_paradox
            #remove_ideas = STG_senshado_state
            remove_ideas = STG_Empty_Throne
            remove_ideas = STG_Graceful_Army
            remove_ideas = STG_Graceful_Army_attack
            remove_ideas = STG_Graceful_Army_defence
            remove_ideas = STG_Hold_Your_Gun
            remove_ideas = STG_Nervous_Army
            remove_ideas = STG_controlled_Army
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            remove_ideas = STG_usr_unrest_end
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            remove_ideas = STG_watch_our_border
            remove_ideas = STG_neutrality_idea
            remove_ideas = STG_unrest_1
            remove_ideas = STG_unrest_2
            remove_ideas = STG_unrest_3
            remove_ideas = STG_unrest_4
            remove_ideas = STG_unrest_5
            remove_ideas = STG_unrest_6
            remove_ideas = STG_ilya_storm
            remove_ideas = STG_ilya_mana
            remove_ideas = STG_rearmament
            remove_ideas = STG_army_reorganization
            remove_ideas = STG_neurtrality_act
            remove_ideas = STG_industrialization_committe
            remove_ideas = STG_controlled_labor_union
            remove_ideas = STG_national_senshado
            remove_ideas = STG_call_of_duty
            remove_ideas = STG_call_of_duty_2
            remove_ideas = STG_cut_mil_cost
            remove_ideas = STG_for_the_emperor
            add_ideas = STG_puppet_of_usr
            add_ideas = STG_voice_of_rebellion
            add_ideas = STG_silent_people_1
            add_ideas = STG_econ_in_chaos
            add_ideas = STG_adm_in_chaos_1
            add_ideas = STG_DrI
            set_party_name = {ideology = fascism long_name = STG_usr_subject_fascism_party_long name = STG_usr_subject_fascism_party}
        }
    }
    hidden_effect = {
        USR = {
            add_ai_strategy = {
                type = alliance
                id = STG
                value = 2000
            }
        }
        STG = {
            add_ai_strategy = {
                type = alliance
                id = USR
                value = 2000
            }
        }
    }
}
#建立STG专员辖区
STG_establish_puppet_aglia_government = {
    STG = {
        set_country_flag = STG_back_to_home
        set_country_flag = STG_disable_internal_ememy_decisions
        set_country_flag = STG_disable_parliament_issues_decisions
        set_variable = {STG_army_discontent = 0}
        set_country_flag = STG_disable_the_sword_of_Damocles_decisions
        STG_clear_state_flag = yes
        if = {
            limit = {
                NOT = {
                    has_country_flag = STG_is_usr_puppet
                }
            }
            set_country_flag = STG_is_usr_puppet
        }
        set_cosmetic_tag = STG_usr_subject_2_fascism
        add_ideas = STG_industralist_return_1
        load_focus_tree = {
            tree = STG_USR_puppet_focus
            keep_completed = yes
        }
        mark_focus_tree_layout_dirty = yes

        add_country_leader_role = {
            character = STG_darjeeling
            promote_leader = yes
            country_leader = {
                ideology = sub_Facism
                expire = "3200.1.1.1"
                desc = "STG_darjeeling_5_desc"
                traits = { TRAIT_STG_dar_grand_protector STG_senshado_concept}
            }
        }
        set_politics = {
            ruling_party = fascism
        }
        hidden_effect = {
            set_party_name = {ideology = democratic name = STG_anglia_puppet_democratic long_name = STG_anglia_puppet_democratic_long}
            set_party_name = {ideology = communism name = STG_anglia_puppet_communism long_name = STG_anglia_puppet_communism_long}
            set_party_name = {ideology = neutrality name = STG_anglia_puppet_neutrality long_name = STG_anglia_puppet_neutrality_long}
            set_party_name = {ideology = reactionism name = STG_anglia_puppet_reactionism long_name = STG_anglia_puppet_reactionism_long}
            set_party_name = {ideology = fascism name = STG_anglia_puppet_fascism long_name = STG_anglia_puppet_fascism_long}
            add_popularity = {
                ideology = reactionism
                popularity = 0.15
            }
            remove_ideas = STG_darjeeling_leader
            remove_ideas = STG_DrI
            add_ideas = STG_orange_pekoe_leader
            set_variable = {STG_usr_unrest = 0}
            set_variable = {STG_cam_unrest = 0}
            set_variable = {STG_army_discontent = 0}
            remove_dynamic_modifier = {modifier = STG_gov_stability_modifier}
        }
    }
}
#检测战争态势
STG_ilya_check_war_stage = {
    if = {
        limit = {
            USR = {surrender_progress > 0.74}
        }
        STG = {
            set_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_2
            clr_country_flag = STG_ilya_war_situation_1
            add_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_2
            remove_ideas = STG_ilya_war_stage_1
        }
    }
    else_if = {
        limit = {
            USR = {surrender_progress > 0.49}
        }
        STG = {
            set_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_2
            clr_country_flag = STG_ilya_war_situation_1
            add_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_2
            remove_ideas = STG_ilya_war_stage_1
        }
    }
    else_if = {
        limit = {
            USR = {surrender_progress > 0.24}
        }
        STG = {
            set_country_flag = STG_ilya_war_situation_2
            clr_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_1
            add_ideas = STG_ilya_war_stage_2
            remove_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_1
        }
    }
    else = {
        STG = {
            set_country_flag = STG_ilya_war_situation_1
            clr_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_2
            add_ideas = STG_ilya_war_stage_1
            remove_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_2
        }
    }
}
#清除战争态势
STG_remove_ilya_war_ideas = {
    STG = {
        clr_country_flag = STG_ilya_war_situation_1
        clr_country_flag = STG_ilya_war_situation_2
        clr_country_flag = STG_ilya_war_situation_3
        clr_country_flag = STG_ilya_war_situation_4
        remove_ideas = STG_ilya_war_stage_1
        remove_ideas = STG_ilya_war_stage_2
        remove_ideas = STG_ilya_war_stage_3
        remove_ideas = STG_ilya_war_stage_4
    }
}
#增加革命热情-小
STG_increase_rev_zeal_1 = {
    custom_effect_tooltip = STG_increase_rev_zeal_1_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 1}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-小
STG_increase_rev_zeal_2 = {
    custom_effect_tooltip = STG_increase_rev_zeal_2_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 2}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-小
STG_increase_rev_zeal_3 = {
    custom_effect_tooltip = STG_increase_rev_zeal_3_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 3}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-小
STG_increase_rev_zeal_small = {
    custom_effect_tooltip = STG_increase_rev_zeal_small_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 5}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情
STG_increase_rev_zeal = {
    custom_effect_tooltip = STG_increase_rev_zeal_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 10}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-大
STG_increase_rev_zeal_big = {
    custom_effect_tooltip = STG_increase_rev_zeal_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 15}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal_1 = {
    custom_effect_tooltip = STG_reduce_rev_zeal_1_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -1}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal_2 = {
    custom_effect_tooltip = STG_reduce_rev_zeal_2_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -2}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal_5 = {
    custom_effect_tooltip = STG_reduce_rev_zeal_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -5}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal = {
    custom_effect_tooltip = STG_reduce_rev_zeal_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -10}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情-大
STG_reduce_rev_zeal_big = {
    custom_effect_tooltip = STG_reduce_rev_zeal_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -20}}
        STG_check_rev_zeal = yes
    }
}
#提高政府势力
STG_increase_gov_strength_2 = {
    custom_effect_tooltip = STG_increase_gov_strength_2_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = 2}}
        STG_check_gov_strength = yes
    }
}
#提高政府势力
STG_increase_gov_strength_5 = {
    custom_effect_tooltip = STG_increase_gov_strength_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = 5}}
        STG_check_gov_strength = yes
    }
}
#提高政府势力
STG_increase_gov_strength_10 = {
    custom_effect_tooltip = STG_increase_gov_strength_10_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = 10}}
        STG_check_gov_strength = yes
    }
}
#降低政府势力
STG_reduce_gov_strength = {
    custom_effect_tooltip = STG_reduce_gov_strength_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = -4}}
        STG_check_gov_strength = yes
    }
}
#降低政府势力-大
STG_reduce_gov_strength_big = {
    custom_effect_tooltip = STG_reduce_gov_strength_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = -8}}
        STG_check_gov_strength = yes
    }
}
#提高军队疑惑
STG_increase_mil_doubt = {
    custom_effect_tooltip = STG_increase_mil_doubt_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = 10}}
        STG_check_gov_strength = yes
    }
}
#提高军队疑惑-大
STG_increase_mil_doubt_big = {
    custom_effect_tooltip = STG_increase_mil_doubt_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = 15}}
        STG_check_gov_strength = yes
    }
}
#降低军队疑惑
STG_reduce_mil_doubt_5 = {
    custom_effect_tooltip = STG_reduce_mil_doubt_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = -5}}
        STG_check_gov_strength = yes
    }
}
#降低军队疑惑
STG_reduce_mil_doubt = {
    custom_effect_tooltip = STG_reduce_mil_doubt_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = -8}}
        STG_check_gov_strength = yes
    }
}
#降低军队疑惑-大
STG_reduce_mil_doubt_big = {
    custom_effect_tooltip = STG_reduce_mil_doubt_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = -15}}
        STG_check_gov_strength = yes
    }
}
#革命热情自然增长
STG_rev_zeal_naturally_increase = {
    custom_effect_tooltip = STG_rev_zeal_naturally_increase_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 8}}
        STG_check_rev_zeal = yes
    }
}
#军队疑惑自然增长
STG_mil_doubt_naturally_increase = {
    custom_effect_tooltip = STG_mil_doubt_naturally_increase_desc
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    is_ai = no
                }
                add_to_variable = {STG_mil_doubt = 8}
            }
        }
        STG_check_mil_doubt = yes
    }
}
#检测革命热情
STG_check_rev_zeal = {
    hidden_effect = {
        STG = {
            clamp_variable = {
                var = STG_rev_zeal
                max = 100
                min = 0
            }
        }
    }
}
STG_rev_random_event_effect = {
    custom_effect_tooltip = STG_rev_random_event_effect_desc
    hidden_effect = {
        STG = {
            set_variable_to_random = {
                var = STG_rev_event_var
                min = 1
                max = 18
                integer = yes
            }
            set_variable_to_random = {
                var = STG_rev_event_time_var
                min = 1
                max = 7
                integer = yes
            }
            if = {
                limit = {
                    OR = {
                        check_variable = {STG_rev_event_var = STG_rev_last_event_var}
                        AND = {
                            check_variable = {STG_rev_event_var = 14}
                            NOT = {has_country_flag = STG_sutdents_join_rev}
                            
                        }
                        AND = { 
                            check_variable = {STG_rev_event_var = 16}
                            check_variable = {STG_gov_strength < 60}
                            has_country_flag = STG_armed_workers
                        }
                        AND = {
                            check_variable = {STG_rev_event_num = 17}
                            NOT = {
                                has_country_flag = STG_armed_workers
                            }
                        }
                    }
                }
            }
            else = {
                meta_effect = {
                    text = {
                        country_event = {id = STG_rev.[STG_REV_EVENT_VAR] days = [STG_REV_EVENT_TIME_VAR]}
                        set_variable = {STG_rev_last_event_var = [STG_REV_EVENT_VAR]}
                    }
                    STG_REV_EVENT_VAR = "[?STG_rev_event_var]"
                    STG_REV_EVENT_TIME_VAR = "[?STG_rev_event_time_var]"
                }
            }
        }
    }
}
#检测军队疑惑
STG_check_mil_doubt = {
    if = {
        limit = {
            STG = {check_variable = {STG_mil_doubt < 0}}
        }
        STG = {set_variable = {STG_mil_doubt = 0}}
    }
    if = {
        limit = {
            STG = {check_variable = {STG_mil_doubt > 99}}
            NOT = {
                has_game_rule = {
                    rule = STG_cheat_revolution
                    option = STG_cheat_revolution_TT
                }
            }
        }
        STG = {
            country_event = {id = STG_com.7}
        }
    }
}
#检测政府势力
STG_check_gov_strength = {
    STG = {
        clamp_variable = {
            var = STG_gov_strength
            min = 0
            max = 100
        }
    }
}
#升级工业派的家园
STG_upgrade_home_of_industralist = {
    if = {
        limit = {
            has_idea = STG_home_of_industralist
        }
        swap_ideas = {
            remove_idea = STG_home_of_industralist
            add_idea = STG_fort_of_industralist
        }
    }
    else_if = {
        limit = {
            has_idea = STG_fort_of_industralist
        }
        swap_ideas = {
            remove_idea = STG_fort_of_industralist
            add_idea = STG_heaven_of_industralist
        }
    }
    else = {
        add_political_power = 50
    }
}
#削弱工业派冲击
STG_reduce_industralist_shock = {
    if = {
        limit = {
            has_idea = STG_industralist_return_1
        }
        swap_ideas = {
            remove_idea = STG_industralist_return_1
            add_idea = STG_industralist_return_2
        }
    }
    else_if = {
        limit = {
            has_idea = STG_industralist_return_2
        }
        swap_ideas = {
            remove_idea = STG_industralist_return_2
            add_idea = STG_industralist_return_3
        }
    }
    else_if = {
        limit = {
            has_idea = STG_industralist_return_3
        }
        swap_ideas = {
            remove_idea = STG_industralist_return_3
            add_idea = STG_industralist_return_4
        }
    }
    else_if = {
        limit = {
            has_idea = STG_industralist_return_4
        }
        remove_ideas = STG_industralist_return_4
    }
}
#红线国家安全系统初始化
STG_rev_national_security_setup = {
    hidden_effect = {
        STG = {
            set_variable = {STG_national_security = 100}#基础安全数值
            set_variable = {STG_security_agency_action_point = 2}#安全局行动点数
            set_variable = {STG_security_agency_action_point_limit = 2}
            set_variable = {STG_armed_picket_action_point = 3}#纠察队行动点数
            set_variable = {STG_armed_picket_action_point_limit = 3}
            set_variable = {STG_rev_national_security_weekly_change = -2}
            set_country_flag = {flag = STG_action_point_recovery_cooldown days = 180 value = 1}
            set_country_flag = {flag = STG_picket_level_worsen_cooldown days = 180 value = 1}
            STG_rev_national_security_weekly_change_effect = yes
        }
    }
}
#国家安全每周变化
STG_rev_national_security_weekly_change_effect = {
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_national_security = modifier@STG_national_security_weekly_change_modifier}
            set_variable = {STG_rev_national_security_weekly_change_display = 0}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = modifier@STG_national_security_weekly_change_modifier}
            STG_rev_national_security_check = yes
            STG_action_point_recovery = yes
        }
    }
}
#安全状态检测
STG_rev_national_security_check = {
    hidden_effect = {
        STG = {
            clamp_variable = {
                var = STG_national_security
                max = 200
                min = 0
            }
            if = {
                limit = {
                    check_variable = {STG_national_security < 26}
                }
                set_variable = {STG_national_security_level = 1}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 25}
                    check_variable = {STG_national_security < 61}
                }
                set_variable = {STG_national_security_level = 2}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 60}
                    check_variable = {STG_national_security < 91}
                }
                set_variable = {STG_national_security_level = 3}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 90}
                    check_variable = {STG_national_security < 141}
                }
                set_variable = {STG_national_security_level = 4}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 140}
                    check_variable = {STG_national_security < 161}
                }
                set_variable = {STG_national_security_level = 5}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 160}
                    check_variable = {STG_national_security < 181}
                }
                set_variable = {STG_national_security_level = 6}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 180}
                }
                set_variable = {STG_national_security_level = 7}
                STG_add_rev_national_security_idea = yes
            }
        }
    }
}
#切换国家精神
STG_add_rev_national_security_idea = {
    hidden_effect = {
        STG = {
            remove_ideas = STG_rev_national_security_level_1
            remove_ideas = STG_rev_national_security_level_2
            remove_ideas = STG_rev_national_security_level_3
            remove_ideas = STG_rev_national_security_level_4
            remove_ideas = STG_rev_national_security_level_5
            remove_ideas = STG_rev_national_security_level_6
            remove_ideas = STG_rev_national_security_level_7
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 1}
                }
                add_ideas = STG_rev_national_security_level_1
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 2}
                }
                add_ideas = STG_rev_national_security_level_2
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 3}
                }
                add_ideas = STG_rev_national_security_level_3
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 4}
                }
                add_ideas = STG_rev_national_security_level_4
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 5}
                }
                add_ideas = STG_rev_national_security_level_5
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 6}
                }
                add_ideas = STG_rev_national_security_level_6
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 7}
                }
                add_ideas = STG_rev_national_security_level_7
            }
        }
    }
}
#行动点数恢复
STG_action_point_recovery = {
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_action_point_recovery_cooldown
                    }
                }
                add_to_variable = {STG_security_agency_action_point = 1}
                add_to_variable = {STG_armed_picket_action_point = 1}
                set_country_flag = {flag = STG_action_point_recovery_cooldown days = 180 value = 1}
            }
            clamp_variable = {
                var = STG_security_agency_action_point
                max = STG_security_agency_action_point_limit
                min = 0
            }
            clamp_variable = {
                var = STG_armed_picket_action_point
                max = STG_armed_picket_action_point_limit
                min = 0
            }
        }
    }
}
#加减安全形势
STG_rev_add_security = {
    custom_effect_tooltip = STG_rev_add_security_t
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = STG_national_security_temp}
            STG_rev_national_security_check = yes
        }
    }
}
#加减安全形势变化
STG_rev_add_security_weekly_change = {
    custom_effect_tooltip = STG_rev_add_security_weekly_change_t
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security_weekly_change = STG_national_security_weekly_change_temp}
        }
    }
}
#安全形势极度恶化
STG_rev_damage_security_very_big = {
    custom_effect_tooltip = STG_rev_damage_security_very_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = -15}
            add_to_variable = {STG_rev_national_security_weekly_change = -0.5}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#安全形势恶化
STG_rev_damage_security_big = {
    custom_effect_tooltip = STG_rev_damage_security_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = -5}
            add_to_variable = {STG_rev_national_security_weekly_change = -0.1}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#安全形势略微恶化
STG_rev_damage_security = {
    custom_effect_tooltip = STG_rev_damage_security_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = -2}
        }
    }
}
#安全形势略微好转
STG_rev_strengthen_security = {
    custom_effect_tooltip = STG_rev_strengthen_security_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = 2}
        }
    }
}
#安全形势好转
STG_rev_strengthen_security_big = {
    custom_effect_tooltip = STG_rev_strengthen_security_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = 5}
            add_to_variable = {STG_rev_national_security_weekly_change = 0.1}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#安全形势大幅好转
STG_rev_strengthen_security_very_big = {
    custom_effect_tooltip = STG_rev_strengthen_security_very_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = 15}
            add_to_variable = {STG_rev_national_security_weekly_change = 0.5}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#红线议会初始化
STG_rev_par_setup = {
    STG = {
        set_variable = {STG_labor_seat = 61}
        set_variable = {STG_labor_supporter = 61}
        set_variable = {STG_left_seat = 41}
        set_variable = {STG_left_supporter = 0}
        set_variable = {STG_sd_seat = 36}
        set_variable = {STG_sd_supporter = 0}
        set_variable = {STG_lsd_seat = 0}
        set_variable = {STG_lsd_supporter = 0}
        set_variable = {STG_dem_seat = 12}
        set_variable = {STG_dem_supporter = 0}
        set_variable = {STG_rev_par_seat = 150}
    }
}
#红线议会支持计算
STG_calculate_rev_par_support = {
    STG = {
        clamp_variable = {
            var = STG_labor_supporter
            max = STG_labor_seat
            min = 0
        }
        if = {
            limit = {check_variable = {STG_left_in_gov = 1}}
            clamp_variable = {
                var = STG_left_supporter
                max = STG_left_seat
                min = 4
            }
        }
        else = {
            clamp_variable = {
                var = STG_left_supporter
                max = STG_left_seat
                min = 0
            }
        }
        if = {
            limit = {check_variable = {STG_sd_in_gov = 1}}
            clamp_variable = {
                var = STG_sd_supporter
                max = STG_sd_seat
                min = 4
            }
        }
        else = {
            clamp_variable = {
                var = STG_sd_supporter
                max = STG_sd_seat
                min = 0
            }
        }
        clamp_variable = {
            var = STG_lsd_supporter
            max = STG_lsd_seat
            min = 0
        }
        clamp_variable = {
            var = STG_dem_supporter
            max = STG_dem_seat
            min = 0
        }
        set_variable = {STG_rev_par_support = 0}
        add_to_variable = {STG_rev_par_support = STG_labor_supporter}
        add_to_variable = {STG_rev_par_support = STG_left_supporter}
        add_to_variable = {STG_rev_par_support = STG_sd_supporter}
        add_to_variable = {STG_rev_par_support = STG_lsd_supporter}
        add_to_variable = {STG_rev_par_support = STG_dem_supporter}
    }
}
#红线随机失去支持
STG_rev_random_lose_a_supporter = {
    custom_effect_tooltip = STG_rev_random_lose_a_supporter_desc
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_rev_sd_collapsed
                    }
                }
                if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    random_list = {
                        33 = {
                            add_to_variable = {STG_left_supporter = -1}
                        }
                        33 = {
                            add_to_variable = {STG_sd_supporter = -1}
                        }
                        33 = {
                            add_to_variable = {STG_dem_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter = 0}
                    }
                    random_list = {
                        50 = {
                            add_to_variable = {STG_left_supporter = -1}
                        }
                        50 = {
                            add_to_variable = {STG_sd_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter = 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    random_list = {
                        50 = {
                            add_to_variable = {STG_dem_supporter = -1}
                        }
                        50 = {
                            add_to_variable = {STG_sd_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter = 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    random_list = {
                        50 = {
                            add_to_variable = {STG_dem_supporter = -1}
                        }
                        50 = {
                            add_to_variable = {STG_left_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter = 0}
                        check_variable = {STG_dem_supporter = 0}
                    }
                    add_to_variable = {STG_left_supporter = -1}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter = 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter = 0}
                    }
                    add_to_variable = {STG_sd_supporter = -1}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter = 0}
                        check_variable = {STG_sd_supporter = 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    add_to_variable = {STG_dem_supporter = -1}
                }
            }
            STG_calculate_rev_par_support = yes
        }
    }
}
#红线好感度计算
STG_rev_galgame_check = {
    STG = {
        clamp_variable = {
            var = STG_left_opinion
            max = 75
            min = 0
        }
        clamp_variable = {
            var = STG_sd_opinion
            max = 75
            min = 0
        }
        clamp_variable = {
            var = STG_dem_opinion
            max = 75
            min = 0
        }
        if = {
            limit = {
                check_variable = {STG_left_opinion > 50}
                NOT = {has_country_flag = STG_left_bonus_seat_cooldown}
            }
            add_to_variable = {STG_left_supporter = 1}
            set_country_flag = {flag = STG_left_bonus_seat_cooldown days = 120 value = 1}
        }
        if = {
            limit = {check_variable = {STG_left_opinion < 26}}
            add_to_variable = {STG_left_supporter = -1}
        }
        if = {
            limit = {
                check_variable = {STG_sd_opinion > 50}
                NOT = {has_country_flag = STG_sd_bonus_seat_cooldown}
            }
            add_to_variable = {STG_sd_supporter = 1}
            set_country_flag = {flag = STG_sd_bonus_seat_cooldown days = 120 value = 1}
        }
        if = {
            limit = {check_variable = {STG_sd_opinion < 26}}
            add_to_variable = {STG_sd_supporter = -1}
        }
        if = {
            limit = {
                check_variable = {STG_dem_opinion > 50}
                NOT = {has_country_flag = STG_dem_bonus_seat_cooldown}
            }
            add_to_variable = {STG_dem_supporter = 1}
            set_country_flag = {flag = STG_dem_bonus_seat_cooldown days = 120 value = 1}
        }
        if = {
            limit = {check_variable = {STG_dem_opinion < 26}}
            add_to_variable = {STG_dem_supporter = -1}
        }
        STG_calculate_rev_par_support = yes
    }
}
STG_rev_support_labor_effect = {

    custom_effect_tooltip = STG_rev_support_labor_effect_desc
    
    hidden_effect = {
        add_to_variable = {STG_labor_supporter = STG_rev_support_labor_temp}
        clamp_variable = {
            var = STG_labor_supporter
            max = STG_labor_seat
            min = 0
        }
    }
}
STG_rev_support_left_effect = {

    custom_effect_tooltip = STG_rev_support_left_effect_desc
    
    hidden_effect = {
        add_to_variable = {STG_left_supporter = STG_rev_support_left_temp}
        clamp_variable = {
            var = STG_left_supporter
            max = STG_left_seat
            min = 0
        }
    }
}
STG_rev_support_sd_effect = {

    custom_effect_tooltip = STG_rev_support_sd_effect_desc
    
    hidden_effect = {
        add_to_variable = {STG_sd_supporter = STG_rev_support_sd_temp}
        clamp_variable = {
            var = STG_sd_supporter
            max = STG_sd_seat
            min = 0
        }
    }
}
STG_rev_support_dem_effect = {

    custom_effect_tooltip = STG_rev_support_dem_effect_desc
    
    hidden_effect = {
        add_to_variable = {STG_dem_supporter = STG_rev_support_dem_temp}
        clamp_variable = {
            var = STG_dem_supporter
            max = STG_dem_seat
            min = 0
        }
    }
}
STG_left_opinion_effect = {

    custom_effect_tooltip = STG_left_opinion_effect_desc
    
    hidden_effect = {
        add_to_variable = {STG_left_opinion = STG_left_opinion_temp}
        clamp_variable = {
            var = STG_left_opinion
            max = 75
            min = 0
        }
    }
}
STG_sd_opinion_effect = {

    custom_effect_tooltip = STG_sd_opinion_effect_desc
    
    hidden_effect = {
        add_to_variable = {STG_sd_opinion = STG_sd_opinion_temp}
        clamp_variable = {
            var = STG_sd_opinion
            max = 75
            min = 0
        }
    }
}
STG_dem_opinion_effect = {

    custom_effect_tooltip = STG_dem_opinion_effect_desc

    hidden_effect = {
        add_to_variable = {STG_dem_opinion = STG_dem_opinion_temp}
        clamp_variable = {
            var = STG_dem_opinion
            max = 75
            min = 0
        }
    }
}

STG_add_evidence_5 = {
    custom_effect_tooltip = STG_add_evidence_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_com_evidence = 5}}
    }
}
STG_add_evidence_10 = {
    custom_effect_tooltip = STG_add_evidence_10_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_com_evidence = 10}}
    }
}
STG_add_evidence_30 = {
    custom_effect_tooltip = STG_add_evidence_30_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_com_evidence = 30}}
    }
}
STG_clear_state_flag = {
    STG = {
        every_core_state = {
            clr_state_flag = normal_seats_flag
            clr_state_flag = new_england_special_seats_flag
            clr_state_flag = einzbern_seats_flag
        }
    }
}
STG_shipbuilding_setup = {
    custom_effect_tooltip = STG_unlock_shipbuilding
    set_country_flag = STG_unlock_shipbuilding_flag
    create_equipment_variant = {
		name = "机动级"
		type = ship_hull_light_2
		parent_version = 0
		modules = {
			fixed_ship_battery_slot = ship_light_battery_2
			fixed_ship_anti_air_slot = ship_anti_air_1
			fixed_ship_fire_control_system_slot = ship_fire_control_system_0
			fixed_ship_radar_slot = ship_sonar_1
			fixed_ship_engine_slot = light_ship_engine_2
			fixed_ship_torpedo_slot = ship_torpedo_1
			mid_1_custom_slot = ship_torpedo_1
			rear_1_custom_slot = ship_depth_charge_1
		}
	}
    if = {
        limit = {
            has_government = communism
        }
        create_equipment_variant = {
            name = "五月起义级"
            type = ship_hull_heavy_1
            parent_version = 0
            allow_without_tech = yes
            modules = {
                fixed_ship_battery_slot = ship_heavy_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_1
                fixed_ship_fire_control_system_slot = ship_fire_control_system_1
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = heavy_ship_engine_2
                fixed_ship_secondaries_slot = dp_ship_secondaries_2
                fixed_ship_armor_slot = ship_armor_bc_2
                front_1_custom_slot = ship_heavy_battery_1
                mid_1_custom_slot = ship_anti_air_1
                mid_2_custom_slot = ship_secondaries_1
                rear_1_custom_slot = ship_heavy_battery_2
            }
        }
        create_equipment_variant = {
            name = "焰火级"
            type = ship_hull_cruiser_2
            allow_without_tech = yes
            parent_version = 0
            modules = {
                fixed_ship_battery_slot = ship_light_medium_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_2
                fixed_ship_fire_control_system_slot = ship_fire_control_system_0
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = cruiser_ship_engine_2
                fixed_ship_armor_slot = ship_armor_cruiser_2
                front_1_custom_slot = ship_anti_air_2
                mid_1_custom_slot = ship_torpedo_1
                mid_2_custom_slot = ship_secondaries_2
                rear_1_custom_slot = ship_light_medium_battery_2
            }
        }
    }
    else = {
        create_equipment_variant = {
            name = "加里波莉级"
            type = ship_hull_heavy_1
            parent_version = 0
            allow_without_tech = yes
            modules = {
                fixed_ship_battery_slot = ship_heavy_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_1
                fixed_ship_fire_control_system_slot = ship_fire_control_system_1
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = heavy_ship_engine_2
                fixed_ship_secondaries_slot = dp_ship_secondaries_2
                fixed_ship_armor_slot = ship_armor_bc_2
                front_1_custom_slot = ship_heavy_battery_1
                mid_1_custom_slot = ship_anti_air_1
                mid_2_custom_slot = ship_secondaries_1
                rear_1_custom_slot = ship_heavy_battery_2
            }
        }
        create_equipment_variant = {
            name = "剑鞘级"
            type = ship_hull_cruiser_2
            allow_without_tech = yes
            parent_version = 0
            modules = {
                fixed_ship_battery_slot = ship_light_medium_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_2
                fixed_ship_fire_control_system_slot = ship_fire_control_system_0
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = cruiser_ship_engine_2
                fixed_ship_armor_slot = ship_armor_cruiser_2
                front_1_custom_slot = ship_anti_air_2
                mid_1_custom_slot = ship_torpedo_1
                mid_2_custom_slot = ship_secondaries_2
                rear_1_custom_slot = ship_light_medium_battery_2
            }
        }
    }
}
STG_add_landing_plan_5 = {
    custom_effect_tooltip = STG_add_landing_plan_5_desc
    add_to_variable = {STG.STG_landing_plan = 5}
}
STG_add_landing_plan_10 = {
    custom_effect_tooltip = STG_add_landing_plan_10_desc
    add_to_variable = {STG.STG_landing_plan = 10}
}
STG_add_landing_plan_15 = {
    custom_effect_tooltip = STG_add_landing_plan_15_desc
    add_to_variable = {STG.STG_landing_plan = 15}
}
STG_ways_of_st_gloriana_bonus_setup = {
    hidden_effect = {
        STG = {
            set_variable = {STG_ways_of_st_gloriana_army_attack_factor_t = 0.01}
            set_variable = {STG_ways_of_st_gloriana_army_defence_factor_t = 0.01}
            set_variable = {STG_ways_of_st_gloriana_breakthrough_factor_t = 0.02}
            set_variable = {STG_ways_of_st_gloriana_army_org_factor_t = 0.02}
            set_variable = {STG_ways_of_st_gloriana_army_attack_factor = STG_ways_of_st_gloriana_army_attack_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_defence_factor = STG_ways_of_st_gloriana_army_defence_factor_t}
            set_variable = {STG_ways_of_st_gloriana_breakthrough_factor = STG_ways_of_st_gloriana_breakthrough_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_org_factor = STG_ways_of_st_gloriana_army_org_factor_t}
        }
    }
}
STG_ways_of_st_gloriana_bonus_update = {
    hidden_effect = {
        STG = {
            set_variable = {STG_ways_of_st_gloriana_skill_counter = 0}
            set_variable = {STG_ways_of_st_gloriana_armor_counter = 0}
            set_variable = {STG_ways_of_st_gloriana_infantry_counter = 0}
            every_unit_leader = {
                if = {
                    limit = {
                        OR = {
                            has_trait = STG_Reformists_Trait
                            has_trait = STG_Academic_Trait
                            has_trait = STG_Shimada_Trait
                        }
                    }
                    if = {
                        limit = {
                            skill > 3
                        }
                        add_to_variable = {STG.STG_ways_of_st_gloriana_skill_counter = 1}
                    }
                    if = {
                        limit = {
                            has_trait = armor_officer
                        }
                        add_to_variable = {STG.STG_ways_of_st_gloriana_armor_counter = 1}
                    }
                    if = {
                        limit = {
                            has_trait = infantry_officer
                        }
                        add_to_variable = {STG.STG_ways_of_st_gloriana_infantry_counter = 1}
                    }
                }
            }
            set_variable = {STG_ways_of_st_gloriana_army_attack_factor = STG_ways_of_st_gloriana_army_attack_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_defence_factor = STG_ways_of_st_gloriana_army_defence_factor_t}
            set_variable = {STG_ways_of_st_gloriana_breakthrough_factor = STG_ways_of_st_gloriana_breakthrough_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_org_factor = STG_ways_of_st_gloriana_army_org_factor_t}
            multiply_variable = {STG_ways_of_st_gloriana_army_attack_factor = STG_ways_of_st_gloriana_skill_counter}
            multiply_variable = {STG_ways_of_st_gloriana_army_defence_factor = STG_ways_of_st_gloriana_skill_counter}
            multiply_variable = {STG_ways_of_st_gloriana_breakthrough_factor = STG_ways_of_st_gloriana_armor_counter}
            multiply_variable = {STG_ways_of_st_gloriana_army_org_factor = STG_ways_of_st_gloriana_infantry_counter}
            if = {
                limit = {
                    is_puppet = no
                    is_in_faction = yes
                    has_idea = USR_senshado_alliance_idea
                }
                set_variable = {STG_ways_of_st_gloriana_industrial_capacity_factory = 0.1}
                set_variable = {STG_ways_of_st_gloriana_army_core_attack_factor = 0}
                set_variable = {STG_ways_of_st_gloriana_army_core_defence_factor = 0}
            }
            else = {
                set_variable = {STG_ways_of_st_gloriana_industrial_capacity_factory = 0}
                set_variable = {STG_ways_of_st_gloriana_army_core_attack_factor = 0.1}
                set_variable = {STG_ways_of_st_gloriana_army_core_defence_factor = 0.1}
            }
        }
    }
}
#设定FNG重建政府
STG_sister_republic_FNG = {
    every_state = {
        limit = {
            is_core_of = UNG
        }
        add_core_of = FNG
    }
    every_state = {
        limit = {
            is_core_of = STG
            is_claimed_by = FNG
        }
        remove_claim_by = FNG
    }
    every_state = {
        limit = {
            is_controlled_by_ROOT_or_ally = yes
            is_core_of = FNG
            NOT = {is_core_of = STG}
        }
        transfer_state_to = FNG
    }
    set_autonomy = {
        target = FNG
        autonomous_state = STG_sister_republic
    }
    FNG = {
        if = {
            limit = {
                NOT = {
                    has_character = UNG_weierlite
                }
            }
            every_possible_country = {
                limit = {
                    has_character = UNG_weierlite
                }
                UNG_weierlite = {
                    set_nationality = FNG
                }
            }
            add_country_leader_role = {
                character = UNG_weierlite
                promote_leader = yes
                country_leader={
                    ideology = sub_Social_Democracy
                    desc = "FNG_weierlite_desc"
                    traits={ TRAIT_UNG_zidongshoujirenou }
                    expire="3200.1.1.1"
                }
            }
        }
        else = {
            promote_character = {
                character = UNG_weierlite
                ideology = sub_Social_Democracy
            }
        }
        set_politics = {
            ruling_party = democratic
        }
        set_country_flag = FNG_reconstruction_flag
        IRIS_unlock_a_new_branch = yes
    }
}


STG_gui_setup = {
    hidden_effect = {
        STG = {
            clear_array = STG_buttons_Array 
            add_to_array = {STG_buttons_Array = token:STG_gui_button_1}
            add_to_array = {STG_buttons_Array = token:STG_gui_button_2}
            add_to_array = {STG_buttons_Array = token:STG_gui_button_3}
            add_to_array = {STG_buttons_Array = token:STG_gui_button_4}

            clear_array = STG_gui_leaders_1_Array
            add_to_array = {STG_gui_leaders_1_Array = token:STG_Wilma_Bishop}
            add_to_array = {STG_gui_leaders_1_Array = token:STG_Winnie}
            add_to_array = {STG_gui_leaders_1_Array = token:STG_Amelia}

            clear_array = STG_gui_leaders_2_Array
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Wilhelmina_Braunschweig}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Sia}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Brown}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Sherwood}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Brand}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Wulis}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Moris}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Karenbell}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_Crowd}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_darjeeling}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_grey}
            add_to_array = {STG_gui_leaders_2_Array = token:STG_orange_pekoe}
        }
    }
}