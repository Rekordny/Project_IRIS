STG_unrest_change = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_is_usr_puppet
            }
        }
        #每周卡美洛派威胁增长
        STG = {
            STG_check_cam_unrest = yes
            STG_check_usr_unrest = yes
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_cam_curshed
                    }
                }
                add_to_variable = {STG_cam_unrest = 0.50}    
            }
            #每周乌斯拉尔裔威胁增长
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_usr_curshed
                    }
                }
                add_to_variable = {STG_usr_unrest = 0.50}    
            }
            #政府稳定度变化
            if = {
                limit = {
                    is_ai = yes
                    check_variable = {STG_global_unrest > 49}
                }
                add_to_variable = {STG_global_unrest = -1}
            }
            if = {
                limit = {
                    has_idea = STG_fort_of_industralist
                }
                add_to_variable = {STG_global_unrest = -0.15}
            }
            if = {
                limit = {
                    has_idea = STG_heaven_of_industralist
                }
                add_to_variable = {STG_global_unrest = -0.3}
            }
            if = {
                limit = {
                    has_stability > 0.99
                }
                add_to_variable = {STG_global_unrest = -0.5}
            }
            if ={
                limit = {
                    has_stability > 0.89
                }
                add_to_variable = {STG_global_unrest = -0.25}
            }
            if ={
                limit = {
                    has_stability > 0.79
                }
                add_to_variable = {STG_global_unrest = -0.25}
            }
            if ={
                limit = {
                    has_stability > 0.69
                }
                add_to_variable = {STG_global_unrest = -0.1}
            }
            if ={
                limit = {
                    has_stability > 0.59
                }
                add_to_variable = {STG_global_unrest = -0.05}
            }
            if ={
                limit = {
                    has_stability > 0.49
                }
                add_to_variable = {STG_global_unrest = -0.05}
            }
            if = {
                limit = {
                    has_idea = STG_usr_discontent_low
                }
                add_to_variable = {STG_global_unrest = 0.25}
            }
            if = {
                limit = {
                    has_idea = STG_usr_discontent_middle
                }
                add_to_variable = {STG_global_unrest = 0.50}
            }    
            if = {
                limit = {
                    has_idea = STG_usr_discontent_high
                }
                add_to_variable = {STG_global_unrest = 0.75}
            }
            if = {
                limit = {
                    has_idea = STG_usr_discontent_very_high
                }
                add_to_variable = {STG_global_unrest = 1}
            }
            if = {
                limit = {
                    has_idea = STG_cam_discontent_low
                }
                add_to_variable = {STG_global_unrest = 0.15}
            }
            if = {
                limit = {
                    has_idea = STG_cam_discontent_middle
                }
                add_to_variable = {STG_global_unrest = 0.35}
            }
            if = {
                limit = {
                    has_idea = STG_cam_discontent_high
                }
                add_to_variable = {STG_global_unrest = 0.55}
            }
            if = {
                limit = {
                    has_idea = STG_cam_discontent_very_high
                }
                add_to_variable = {STG_global_unrest = 1}
            }
            if = {
                limit = {
                    has_idea = STG_investigation
                }
                add_to_variable = {STG_global_unrest = 0.5}
            }	
            if = {
                limit = {
                    has_country_flag = STG_cam_curshed
                }
                add_to_variable = {STG_global_unrest = -0.5}
            }		
            if = {
                limit = {
                    has_country_flag = STG_usr_curshed
                }
                add_to_variable = {STG_global_unrest = -0.5}
            }
            clamp_variable = {
                var = STG_global_unrest
                min = 0
            }	
            STG_check_unrest = yes
        }
    }
}

#检测政府稳定
STG_check_unrest = {
    if = {
        limit = {
            NOT = {has_country_flag = STG_disable_unrest_flag}
        }
        if = {
            limit = {
                STG = {
                    check_variable = {STG_global_unrest > 80}
                }
            }
            STG = {
                if = {
                    limit = {
                        has_idea = STG_unrest_1
                    }
                    remove_ideas = STG_unrest_1
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_2
                    }
                    remove_ideas = STG_unrest_2
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_3
                    }
                    remove_ideas = STG_unrest_3
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_4
                    }
                    remove_ideas = STG_unrest_4
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_5
                    }
                    remove_ideas = STG_unrest_5
                }
                if = {
                    limit = {
                        NOT = {
                            has_idea = STG_unrest_6
                        }
                    }
                    add_ideas = STG_unrest_6
                }
            }
        }
        else_if = {
            limit = {
                STG = {
                    check_variable = {STG_global_unrest > 60}
                }
            }
            STG = {
                if = {
                    limit = {
                        has_idea = STG_unrest_1
                    }
                    remove_ideas = STG_unrest_1
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_2
                    }
                    remove_ideas = STG_unrest_2
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_3
                    }
                    remove_ideas = STG_unrest_3
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_4
                    }
                    remove_ideas = STG_unrest_4
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_6
                    }
                    remove_ideas = STG_unrest_6
                }
                if = {
                    limit = {
                        NOT = {
                            has_idea = STG_unrest_5
                        }
                    }
                    add_ideas = STG_unrest_5
                }
            }
        }
        else_if = {
            limit = {
                STG = {
                    check_variable = {STG_global_unrest > 40}
                }
            }
            STG = {
                if = {
                    limit = {
                        has_idea = STG_unrest_1
                    }
                    remove_ideas = STG_unrest_1
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_2
                    }
                    remove_ideas = STG_unrest_2
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_3
                    }
                    remove_ideas = STG_unrest_3
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_5
                    }
                    remove_ideas = STG_unrest_5
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_6
                    }
                    remove_ideas = STG_unrest_6
                }
                if = {
                    limit = {
                        NOT = {
                            has_idea = STG_unrest_4
                        }
                    }
                    add_ideas = STG_unrest_4
                }
            }
        }
        else_if = {
            limit = {
                STG = {
                    check_variable = {STG_global_unrest > 25}
                }
            }
            STG = {
                if = {
                    limit = {
                        has_idea = STG_unrest_1
                    }
                    remove_ideas = STG_unrest_1
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_2
                    }
                    remove_ideas = STG_unrest_2
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_4
                    }
                    remove_ideas = STG_unrest_4
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_5
                    }
                    remove_ideas = STG_unrest_5
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_6
                    }
                    remove_ideas = STG_unrest_6
                }
                if = {
                    limit = {
                        NOT = {
                            has_idea = STG_unrest_3
                        }
                    }
                    add_ideas = STG_unrest_3
                }
            }
        }
        else_if = {
            limit = {
                STG = {
                    check_variable = {STG_global_unrest > 10}
                }
            }
            STG = {
                if = {
                    limit = {
                        has_idea = STG_unrest_1
                    }
                    remove_ideas = STG_unrest_1
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_3
                    }
                    remove_ideas = STG_unrest_3
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_4
                    }
                    remove_ideas = STG_unrest_4
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_5
                    }
                    remove_ideas = STG_unrest_5
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_6
                    }
                    remove_ideas = STG_unrest_6
                }
                if = {
                    limit ={
                        NOT = {
                            has_idea = STG_unrest_2
                        }
                    }
                    add_ideas = STG_unrest_2
                }
            }
        }
        else_if = {
            limit = {
                STG = {
                    check_variable = {var = STG_global_unrest value = 0 compare = greater_than_or_equals}
                }
            }
            STG = {
                if = {
                    limit = {
                        has_idea = STG_unrest_2
                    }
                    remove_ideas = STG_unrest_2
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_3
                    }
                    remove_ideas = STG_unrest_3
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_4
                    }
                    remove_ideas = STG_unrest_4
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_5
                    }
                    remove_ideas = STG_unrest_5
                }
                if = {
                    limit = {
                        has_idea = STG_unrest_6
                    }
                    remove_ideas = STG_unrest_6
                }
                if = {
                    limit = {
                        NOT = {
                            has_idea = STG_unrest_1
                        }
                    }
                    add_ideas = STG_unrest_1
                }
            }
        }
    }
}
#检测卡美洛派威胁
STG_check_cam_unrest = {
    if = {
        limit = {
            has_country_flag = STG_cam_crushed
        }
        STG = {
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            remove_ideas = STG_cam_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest < 10}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            add_ideas = STG_cam_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest > 20}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            add_ideas = STG_cam_discontent_middle
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest > 40}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_very_high
            add_ideas = STG_cam_discontent_high
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_cam_unrest > 60}
            }
        }
        STG = {
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            add_ideas = STG_cam_discontent_very_high
        }
    }
}
#检测乌斯拉尔裔威胁
STG_check_usr_unrest = {
    if = {
        limit = {
            has_country_flag = STG_usr_crushed
        }
        STG = {
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            remove_ideas = STG_usr_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest < 10}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            add_ideas = STG_usr_discontent_low
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest > 20}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            add_ideas = STG_usr_discontent_middle
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest > 40}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_very_high
            add_ideas = STG_usr_discontent_high
        }
    }
    else_if = {
        limit = {
            STG = {
                check_variable = {STG_usr_unrest > 60}
            }
        }
        STG = {
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            add_ideas = STG_usr_discontent_very_high
        }
    }
}
#安抚乌斯拉尔裔
STG_reduce_usr_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_usr_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = -5}}
            STG_check_usr_unrest = yes
        }
    }
}
#安抚乌斯拉尔裔-大
STG_reduce_usr_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_usr_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = -10}}
            STG_check_usr_unrest = yes
        }
    }
}
#激怒乌斯拉尔裔
STG_increase_usr_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_increase_usr_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = 5}}
            STG_check_usr_unrest = yes
        }
    }
}
#激怒乌斯拉尔裔-大
STG_increase_usr_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_usr_crushed
            }
        }
        custom_effect_tooltip = STG_increase_usr_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_usr_unrest = 10}}
            STG_check_usr_unrest = yes
        }
    }
}
#打击卡美洛派
STG_reduce_cam_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_cam_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = -5}}
            STG_check_cam_unrest = yes
        }
    }
}
#打击卡美洛派-大
STG_reduce_cam_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_reduce_cam_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = -10}}
            STG_check_cam_unrest = yes
        }
    }
}
#激怒卡美洛派
STG_increase_cam_unrest = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_increase_cam_unrest_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = 5}}
            STG_check_cam_unrest = yes
        }
    }
}
#激怒卡美洛派-大
STG_increase_cam_unrest_big = {
    if = {
        limit = {
            NOT = {
                has_country_flag = STG_cam_crushed
            }
        }
        custom_effect_tooltip = STG_increase_cam_unrest_big_desc
        hidden_effect = {
            STG = {add_to_variable = {STG_cam_unrest = 10}}
            STG_check_cam_unrest = yes
        }
    }
}
#提高稳定度
STG_decrease_global_unrest = {
    custom_effect_tooltip = STG_decrease_global_unrest_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_global_unrest = -5}}
        STG_check_unrest = yes
    }
}
#提高稳定度-大
STG_decrease_global_unrest_big = {
    custom_effect_tooltip = STG_decrease_global_unrest_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_global_unrest = -10}}
        STG_check_unrest = yes
    }
}
#降低稳定度
STG_increase_global_unrest = {
    custom_effect_tooltip = STG_increase_global_unrest_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_global_unrest = 5}}
        STG_check_unrest = yes
    }
}
#降低稳定度-大
STG_increase_global_unrest_big = {
    custom_effect_tooltip = STG_increase_global_unrest_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_global_unrest = 10}}
        STG_check_unrest = yes
    }
}
#降低稳定度-极大
STG_increase_global_unrest_very_big = {
    custom_effect_tooltip = STG_increase_global_unrest_very_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_global_unrest = 20}}
        STG_check_unrest = yes
    }
}
STG_change_supporter = {
    if = {
        limit = {
            check_variable = {STG_supporter_temp < 0}
        }
        custom_effect_tooltip = STG_reduce_supporter_desc
    }
    else = {
        custom_effect_tooltip = STG_add_supporter_desc
    }
    hidden_effect = {
        add_to_variable = {STG_supporter = STG_supporter_temp}
        STG_check_supporters = yes
    }
}
#检测支持
STG_check_supporters = {
    if = {
        limit = {
            has_country_flag = STG_ilya_issue_1_passed

        }
        clamp_variable = {
            var = STG_supporter
            max = 33
            min = 0
        }
    }
    else = {
        clamp_variable = {
            var = STG_supporter
            max = 30
            min = 0
        }
    }

}
#检测军队不满
STG_check_army_discontent = {
    STG = {
        clamp_variable = {
            var = STG_army_discontent
            max = 100
            min = 0
        }
    }
}
#减少军队不满
STG_reduce_army_discontent = {
    custom_effect_tooltip = STG_reduce_army_discontent_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = -5}}
        STG_check_army_discontent = yes
    }
}
#减少军队不满-大
STG_reduce_army_discontent_big = {
    custom_effect_tooltip = STG_reduce_army_discontent_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = -10}}
        STG_check_army_discontent = yes
    }
}
#减少军队不满-大
STG_reduce_army_discontent_15 = {
    custom_effect_tooltip = STG_reduce_army_discontent_15_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = -15}}
        STG_check_army_discontent = yes
    }
}
#增加军队不满
STG_increase_army_discontent = {
    custom_effect_tooltip = STG_increase_army_discontent_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = 5}}
        STG_check_army_discontent = yes
    }
}
#增加军队不满-大
STG_increase_army_discontent_big = {
    custom_effect_tooltip = STG_increase_army_discontent_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_army_discontent = 10}}
        STG_check_army_discontent = yes
    }
}
#设定为USR傀儡
STG_became_USR_puppet = {
    STG = {
        set_country_flag = STG_is_usr_puppet
        add_stability = -0.20
        add_war_support = -0.20
        add_manpower = -25000
        set_politics = {
            ruling_party = fascism
        }
        promote_character = {
            character = STG_BF109
            ideology = sub_Facism
        }
        add_popularity = {
            ideology = fascism
            popularity = 0.15
        }
        country_lock_all_division_template = no
        delete_unit_template_and_units = {
            division_template = "St. Gloriana Tank Division"
            disband = no
        }
        delete_unit_template_and_units = {
            division_template = "National Guard"
            disband = no
        }
        set_country_flag = STG_disable_internal_ememy_decisions
        set_country_flag = STG_disable_parliament_issues_decisions
        STG_clear_state_flag = yes
        set_country_flag = STG_disable_the_sword_of_Damocles_decisions
        set_country_flag = disallow_stg_leaders
        set_cosmetic_tag = STG_usr_subject_fascism
        hidden_effect = {
            if = {
                limit = {
                    has_global_flag = Anglia_RECONCLIATION_FLAG
                }
                remove_opinion_modifier = {
                    target = FNG
                    modifier = Anglia_Reconcilation
                }
                diplomatic_relation = {
                    country = FNG
                    relation = guarantee
                    active = no
                }
                FNG = {
                    diplomatic_relation = {
                        country = STG
                        relation = guarantee
                        active = no
                    }
                    remove_opinion_modifier = {
                        target = STG
                        modifier = Anglia_Reconcilation
                    }
                }
            }
            country_event = {id = STG_civ_war.1 days = 250}
            news_event = {id = STG_news.11 days = 3}
            remove_power_balance = {id = STG_centralized_vs_decentralized}
            load_focus_tree = {
                tree = STG_USR_puppet_focus
                keep_completed = yes
            }
            mark_focus_tree_layout_dirty = yes
            remove_ideas = STG_home_of_industralist
            remove_ideas = STG_fort_of_industralist
            remove_ideas = STG_heaven_of_industralist
            remove_ideas = STG_full_of_corruption
            remove_ideas = STG_darjeeling_leader
            remove_ideas = STG_orange_pekoe_leader
            remove_ideas = STG_paradox
            #remove_ideas = STG_senshado_state
            remove_ideas = STG_Empty_Throne
            remove_ideas = STG_Graceful_Army
            remove_ideas = STG_Graceful_Army_attack
            remove_ideas = STG_Graceful_Army_defence
            remove_ideas = STG_Hold_Your_Gun
            remove_ideas = STG_Nervous_Army
            remove_ideas = STG_controlled_Army
            remove_ideas = STG_usr_discontent_low
            remove_ideas = STG_usr_discontent_middle
            remove_ideas = STG_usr_discontent_high
            remove_ideas = STG_usr_discontent_very_high
            remove_ideas = STG_usr_unrest_end
            remove_ideas = STG_cam_discontent_low
            remove_ideas = STG_cam_discontent_middle
            remove_ideas = STG_cam_discontent_high
            remove_ideas = STG_cam_discontent_very_high
            remove_ideas = STG_watch_our_border
            remove_ideas = STG_neutrality_idea
            remove_ideas = STG_unrest_1
            remove_ideas = STG_unrest_2
            remove_ideas = STG_unrest_3
            remove_ideas = STG_unrest_4
            remove_ideas = STG_unrest_5
            remove_ideas = STG_unrest_6
            remove_ideas = STG_ilya_storm
            remove_ideas = STG_ilya_mana
            remove_ideas = STG_rearmament
            remove_ideas = STG_army_reorganization
            remove_ideas = STG_neurtrality_act
            remove_ideas = STG_industrialization_committe
            remove_ideas = STG_controlled_labor_union
            remove_ideas = STG_national_senshado
            remove_ideas = STG_call_of_duty
            remove_ideas = STG_call_of_duty_2
            remove_ideas = STG_cut_mil_cost
            remove_ideas = STG_for_the_emperor
            add_ideas = STG_puppet_of_usr
            add_ideas = STG_voice_of_rebellion
            add_ideas = STG_silent_people_1
            add_ideas = STG_econ_in_chaos
            add_ideas = STG_adm_in_chaos_1
            add_ideas = STG_DrI
            set_party_name = {ideology = fascism long_name = STG_usr_subject_fascism_party_long name = STG_usr_subject_fascism_party}
        }
    }
    hidden_effect = {
        USR = {
            add_ai_strategy = {
                type = alliance
                id = STG
                value = 2000
            }
        }
        STG = {
            add_ai_strategy = {
                type = alliance
                id = USR
                value = 2000
            }
        }
    }
}
#建立STG专员辖区
STG_establish_puppet_aglia_government = {
    STG = {
        set_country_flag = STG_back_to_home
        set_country_flag = STG_disable_internal_ememy_decisions
        set_country_flag = STG_disable_parliament_issues_decisions
        set_country_flag = STG_disable_the_sword_of_Damocles_decisions
        STG_clear_state_flag = yes
        if = {
            limit = {
                NOT = {
                    has_country_flag = STG_is_usr_puppet
                }
            }
            set_country_flag = STG_is_usr_puppet
        }
        set_cosmetic_tag = STG_usr_subject_2_fascism
        add_ideas = STG_industralist_return_1
        load_focus_tree = {
            tree = STG_USR_puppet_focus
            keep_completed = yes
        }
        mark_focus_tree_layout_dirty = yes

        add_country_leader_role = {
            character = STG_darjeeling
            promote_leader = yes
            country_leader = {
                ideology = sub_Facism
                expire = "3200.1.1.1"
                desc = "STG_darjeeling_5_desc"
                traits = { TRAIT_STG_dar_grand_protector STG_senshado_concept}
            }
        }
        set_politics = {
            ruling_party = fascism
        }
        hidden_effect = {
            set_party_name = {ideology = democratic name = STG_anglia_puppet_democratic long_name = STG_anglia_puppet_democratic_long}
            set_party_name = {ideology = communism name = STG_anglia_puppet_communism long_name = STG_anglia_puppet_communism_long}
            set_party_name = {ideology = neutrality name = STG_anglia_puppet_neutrality long_name = STG_anglia_puppet_neutrality_long}
            set_party_name = {ideology = reactionism name = STG_anglia_puppet_reactionism long_name = STG_anglia_puppet_reactionism_long}
            set_party_name = {ideology = fascism name = STG_anglia_puppet_fascism long_name = STG_anglia_puppet_fascism_long}
            add_popularity = {
                ideology = reactionism
                popularity = 0.15
            }
            remove_ideas = STG_darjeeling_leader
            remove_ideas = STG_DrI
            add_ideas = STG_orange_pekoe_leader
            set_variable = {STG_usr_unrest = 0}
            set_variable = {STG_cam_unrest = 0}
            set_variable = {STG_global_unrest = 0}
        }
    }
}
#检测战争态势
STG_ilya_check_war_stage = {
    if = {
        limit = {
            USR = {surrender_progress > 0.74}
        }
        STG = {
            set_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_2
            clr_country_flag = STG_ilya_war_situation_1
            add_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_2
            remove_ideas = STG_ilya_war_stage_1
        }
    }
    else_if = {
        limit = {
            USR = {surrender_progress > 0.49}
        }
        STG = {
            set_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_2
            clr_country_flag = STG_ilya_war_situation_1
            add_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_2
            remove_ideas = STG_ilya_war_stage_1
        }
    }
    else_if = {
        limit = {
            USR = {surrender_progress > 0.24}
        }
        STG = {
            set_country_flag = STG_ilya_war_situation_2
            clr_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_1
            add_ideas = STG_ilya_war_stage_2
            remove_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_1
        }
    }
    else = {
        STG = {
            set_country_flag = STG_ilya_war_situation_1
            clr_country_flag = STG_ilya_war_situation_4
            clr_country_flag = STG_ilya_war_situation_3
            clr_country_flag = STG_ilya_war_situation_2
            add_ideas = STG_ilya_war_stage_1
            remove_ideas = STG_ilya_war_stage_4
            remove_ideas = STG_ilya_war_stage_3
            remove_ideas = STG_ilya_war_stage_2
        }
    }
}
#清除战争态势
STG_remove_ilya_war_ideas = {
    STG = {
        clr_country_flag = STG_ilya_war_situation_1
        clr_country_flag = STG_ilya_war_situation_2
        clr_country_flag = STG_ilya_war_situation_3
        clr_country_flag = STG_ilya_war_situation_4
        remove_ideas = STG_ilya_war_stage_1
        remove_ideas = STG_ilya_war_stage_2
        remove_ideas = STG_ilya_war_stage_3
        remove_ideas = STG_ilya_war_stage_4
    }
}
#增加革命热情-小
STG_increase_rev_zeal_1 = {
    custom_effect_tooltip = STG_increase_rev_zeal_1_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 1}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-小
STG_increase_rev_zeal_2 = {
    custom_effect_tooltip = STG_increase_rev_zeal_2_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 2}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-小
STG_increase_rev_zeal_3 = {
    custom_effect_tooltip = STG_increase_rev_zeal_3_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 3}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-小
STG_increase_rev_zeal_small = {
    custom_effect_tooltip = STG_increase_rev_zeal_small_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 5}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情
STG_increase_rev_zeal = {
    custom_effect_tooltip = STG_increase_rev_zeal_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 10}}
        STG_check_rev_zeal = yes
    }
}
#增加革命热情-大
STG_increase_rev_zeal_big = {
    custom_effect_tooltip = STG_increase_rev_zeal_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 15}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal_1 = {
    custom_effect_tooltip = STG_reduce_rev_zeal_1_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -1}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal_2 = {
    custom_effect_tooltip = STG_reduce_rev_zeal_2_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -2}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal_5 = {
    custom_effect_tooltip = STG_reduce_rev_zeal_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -5}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情
STG_reduce_rev_zeal = {
    custom_effect_tooltip = STG_reduce_rev_zeal_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -10}}
        STG_check_rev_zeal = yes
    }
}
#降低革命热情-大
STG_reduce_rev_zeal_big = {
    custom_effect_tooltip = STG_reduce_rev_zeal_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = -20}}
        STG_check_rev_zeal = yes
    }
}
#提高政府势力
STG_increase_gov_strength_2 = {
    custom_effect_tooltip = STG_increase_gov_strength_2_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = 2}}
        STG_check_gov_strength = yes
    }
}
#提高政府势力
STG_increase_gov_strength_5 = {
    custom_effect_tooltip = STG_increase_gov_strength_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = 5}}
        STG_check_gov_strength = yes
    }
}
#提高政府势力
STG_increase_gov_strength_10 = {
    custom_effect_tooltip = STG_increase_gov_strength_10_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = 10}}
        STG_check_gov_strength = yes
    }
}
#降低政府势力
STG_reduce_gov_strength = {
    custom_effect_tooltip = STG_reduce_gov_strength_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = -4}}
        STG_check_gov_strength = yes
    }
}
#降低政府势力-大
STG_reduce_gov_strength_big = {
    custom_effect_tooltip = STG_reduce_gov_strength_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_gov_strength = -8}}
        STG_check_gov_strength = yes
    }
}
#提高军队疑惑
STG_increase_mil_doubt = {
    custom_effect_tooltip = STG_increase_mil_doubt_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = 10}}
        STG_check_gov_strength = yes
    }
}
#提高军队疑惑-大
STG_increase_mil_doubt_big = {
    custom_effect_tooltip = STG_increase_mil_doubt_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = 15}}
        STG_check_gov_strength = yes
    }
}
#降低军队疑惑
STG_reduce_mil_doubt_5 = {
    custom_effect_tooltip = STG_reduce_mil_doubt_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = -5}}
        STG_check_gov_strength = yes
    }
}
#降低军队疑惑
STG_reduce_mil_doubt = {
    custom_effect_tooltip = STG_reduce_mil_doubt_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = -8}}
        STG_check_gov_strength = yes
    }
}
#降低军队疑惑-大
STG_reduce_mil_doubt_big = {
    custom_effect_tooltip = STG_reduce_mil_doubt_big_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_mil_doubt = -15}}
        STG_check_gov_strength = yes
    }
}
#革命热情自然增长
STG_rev_zeal_naturally_increase = {
    custom_effect_tooltip = STG_rev_zeal_naturally_increase_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_rev_zeal = 8}}
        STG_check_rev_zeal = yes
    }
}
#军队疑惑自然增长
STG_mil_doubt_naturally_increase = {
    custom_effect_tooltip = STG_mil_doubt_naturally_increase_desc
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    is_ai = no
                }
                add_to_variable = {STG_mil_doubt = 8}
            }
        }
        STG_check_mil_doubt = yes
    }
}
#检测革命热情
STG_check_rev_zeal = {
    hidden_effect = {
        STG = {
            clamp_variable = {
                var = STG_rev_zeal
                max = 100
                min = 0
            }
        }
    }
}
STG_rev_random_event_effect = {
    custom_effect_tooltip = STG_rev_random_event_effect_desc
    hidden_effect = {
        STG = {
            set_variable_to_random = {
                var = STG_rev_event_num
                min = 1
                max = 18
                integer = yes
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 1}
                }
                country_event = {id = STG_rev.1}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 2}
                }
                country_event = {id = STG_rev.2}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 3}
                }
                country_event = {id = STG_rev.3}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 4}
                }
                country_event = {id = STG_rev.4}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 5}
                }
                country_event = {id = STG_rev.5}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 6}
                }
                country_event = {id = STG_rev.6}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 7}
                }
                country_event = {id = STG_rev.7}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 8}
                }
                country_event = {id = STG_rev.8}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 9}
                }
                country_event = {id = STG_rev.9}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 10}
                }
                country_event = {id = STG_rev.10}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 1}
                }
                country_event = {id = STG_rev.1}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 11}
                }
                country_event = {id = STG_rev.11}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 12}
                }
                country_event = {id = STG_rev.12}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 13}
                    has_completed_focus = STG_com_2
                }
                country_event = {id = STG_rev.13}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 14}
                    has_country_flag = STG_sutdents_join_rev
                }
                country_event = {id = STG_rev.14}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 15}
                }
                country_event = {id = STG_rev.15}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 16}
                    check_variable = {STG_gov_strength < 60}
                    NOT = {
                        has_country_flag = STG_armed_workers
                    }
                }
                country_event = {id = STG_rev.16}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 17}
                    has_country_flag = STG_armed_workers
                }
                country_event = {id = STG_rev.17}
            }
            if = {
                limit = {
                    check_variable = {STG_rev_event_num = 18}
                }
                country_event = {id = STG_rev.18}
            }
        }
    }
}
#检测军队疑惑
STG_check_mil_doubt = {
    if = {
        limit = {
            STG = {check_variable = {STG_mil_doubt < 0}}
        }
        STG = {set_variable = {STG_mil_doubt = 0}}
    }
    if = {
        limit = {
            STG = {check_variable = {STG_mil_doubt > 99}}
            NOT = {
                has_game_rule = {
                    rule = STG_cheat_revolution
                    option = STG_cheat_revolution_TT
                }
            }
        }
        STG = {
            country_event = {id = STG_com.7}
        }
    }
}
#检测政府势力
STG_check_gov_strength = {
    if = {
        limit = {
            STG = {check_variable = {STG_gov_strength < 0}}
        }
        STG = {set_variable = {STG_gov_strength = 0}}
    }
    if = {
        limit = {
            STG = {check_variable = {STG_gov_strength > 100}}
        }
        STG = {set_variable = {STG_gov_strength = 100}}
    }
}
#升级工业派的家园
STG_upgrade_home_of_industralist = {
    if = {
        limit = {
            has_idea = STG_home_of_industralist
        }
        swap_ideas = {
            remove_idea = STG_home_of_industralist
            add_idea = STG_fort_of_industralist
        }
    }
    else_if = {
        limit = {
            has_idea = STG_fort_of_industralist
        }
        swap_ideas = {
            remove_idea = STG_fort_of_industralist
            add_idea = STG_heaven_of_industralist
        }
    }
    else = {
        add_political_power = 50
    }
}
#削弱工业派冲击
STG_reduce_industralist_shock = {
    if = {
        limit = {
            has_idea = STG_industralist_return_1
        }
        swap_ideas = {
            remove_idea = STG_industralist_return_1
            add_idea = STG_industralist_return_2
        }
    }
    else_if = {
        limit = {
            has_idea = STG_industralist_return_2
        }
        swap_ideas = {
            remove_idea = STG_industralist_return_2
            add_idea = STG_industralist_return_3
        }
    }
    else_if = {
        limit = {
            has_idea = STG_industralist_return_3
        }
        swap_ideas = {
            remove_idea = STG_industralist_return_3
            add_idea = STG_industralist_return_4
        }
    }
    else_if = {
        limit = {
            has_idea = STG_industralist_return_4
        }
        remove_ideas = STG_industralist_return_4
    }
}


#议会排版计算 by白衣
STG_Insert_Party_Position = {
    STG = {
        clear_array = STG_seat_x_array
        clear_array = STG_seat_y_array
        clear_array = STG_parliament_issues_array
        #空闲
        set_variable = {
            OCF_gridbox_seat_array_waiver = 33
        }

        resize_array = {
            array = STG_parliament_issues_array
            value = 8
            size = STG_supporter
        }
        resize_array = {
            array = STG_parliament_issues_array
            value = 2
            size = STG_seats
        }
        resize_array = {
            array = STG_parliament_issues_array
            value = 9
            size = 33
        }

        add_to_array = { STG_seat_x_array = 0 }
        add_to_array = { STG_seat_y_array = 75 }
        add_to_array = { STG_seat_x_array = 11 }
        add_to_array = { STG_seat_y_array = 75 }
        add_to_array = { STG_seat_x_array = 22 }
        add_to_array = { STG_seat_y_array = 75 }
        add_to_array = { STG_seat_x_array = 3 }
        add_to_array = { STG_seat_y_array = 63 }
        add_to_array = { STG_seat_x_array = 15 }
        add_to_array = { STG_seat_y_array = 63 }
        add_to_array = { STG_seat_x_array = 9 }
        add_to_array = { STG_seat_y_array = 52 }
        add_to_array = { STG_seat_x_array = 28 }
        add_to_array = { STG_seat_y_array = 63 }
        add_to_array = { STG_seat_x_array = 23 }
        add_to_array = { STG_seat_y_array = 52 }
        add_to_array = { STG_seat_x_array = 17 }
        add_to_array = { STG_seat_y_array = 42 }
        add_to_array = { STG_seat_x_array = 38 }
        add_to_array = { STG_seat_y_array = 54 }
        add_to_array = { STG_seat_x_array = 33 }
        add_to_array = { STG_seat_y_array = 44 }
        add_to_array = { STG_seat_x_array = 27 }
        add_to_array = { STG_seat_y_array = 35 }
        add_to_array = { STG_seat_x_array = 38 }
        add_to_array = { STG_seat_y_array = 30 }
        add_to_array = { STG_seat_x_array = 44 }
        add_to_array = { STG_seat_y_array = 39 }
        add_to_array = { STG_seat_x_array = 50 }
        add_to_array = { STG_seat_y_array = 49 }
        add_to_array = { STG_seat_x_array = 51 }
        add_to_array = { STG_seat_y_array = 27 }
        add_to_array = { STG_seat_x_array = 57 }
        add_to_array = { STG_seat_y_array = 38 }
        add_to_array = { STG_seat_x_array = 63 }
        add_to_array = { STG_seat_y_array = 27 }
        add_to_array = { STG_seat_x_array = 63 }
        add_to_array = { STG_seat_y_array = 49 }
        add_to_array = { STG_seat_x_array = 69 }
        add_to_array = { STG_seat_y_array = 39 }
        add_to_array = { STG_seat_x_array = 75 }
        add_to_array = { STG_seat_y_array = 30 }
        add_to_array = { STG_seat_x_array = 86 }
        add_to_array = { STG_seat_y_array = 35 }
        add_to_array = { STG_seat_x_array = 81 }
        add_to_array = { STG_seat_y_array = 44 }
        add_to_array = { STG_seat_x_array = 76 }
        add_to_array = { STG_seat_y_array = 54 }
        add_to_array = { STG_seat_x_array = 96 }
        add_to_array = { STG_seat_y_array = 42 }
        add_to_array = { STG_seat_x_array = 91 }
        add_to_array = { STG_seat_y_array = 52 }
        add_to_array = { STG_seat_x_array = 86 }
        add_to_array = { STG_seat_y_array = 63 }
        add_to_array = { STG_seat_x_array = 104 }
        add_to_array = { STG_seat_y_array = 52 }
        add_to_array = { STG_seat_x_array = 98 }
        add_to_array = { STG_seat_y_array = 63 }
        add_to_array = { STG_seat_x_array = 110 }
        add_to_array = { STG_seat_y_array = 63 }
        add_to_array = { STG_seat_x_array = 91 }
        add_to_array = { STG_seat_y_array = 75 }
        add_to_array = { STG_seat_x_array = 103 }
        add_to_array = { STG_seat_y_array = 75 }
        add_to_array = { STG_seat_x_array = 114 }
        add_to_array = { STG_seat_y_array = 75 }
    }
}
#红线国家安全系统初始化
STG_rev_national_security_setup = {
    hidden_effect = {
        STG = {
            set_variable = {STG_national_security = 100}#基础安全数值
            set_variable = {STG_security_agency_action_point = 2}#安全局行动点数
            set_variable = {STG_security_agency_action_point_limit = 2}
            set_variable = {STG_armed_picket_action_point = 3}#纠察队行动点数
            set_variable = {STG_armed_picket_action_point_limit = 3}
            set_variable = {STG_armed_picket_level = 1}#纠察队等级
            set_variable = {STG_rev_national_security_weekly_change = -1.8}
            set_country_flag = {flag = STG_action_point_recovery_cooldown days = 180 value = 1}
            set_country_flag = {flag = STG_picket_level_worsen_cooldown days = 180 value = 1}
        }
    }
}
#国家安全每周变化
STG_rev_national_security_weekly_change_effect = {
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    check_variable = {STG_armed_picket_level = 1}
                }
                set_variable = {STG_rev_national_security_picket = -0.2}
            }
            if = {
                limit = {
                    check_variable = {STG_armed_picket_level = 2}
                }
                set_variable = {STG_rev_national_security_picket = 0}
            }
            if = {
                limit = {
                    check_variable = {STG_armed_picket_level = 3}
                }
                set_variable = {STG_rev_national_security_picket = 0.2}
            }
            add_to_variable = {STG_national_security = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_national_security = STG_rev_national_security_picket}
            add_to_variable = {STG_national_security = modifier@STG_rev_national_security_weekly_change_modifier}
            set_variable = {STG_rev_national_security_weekly_change_display = 0}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
            add_to_variable = {STG_rev_national_security_weekly_change_display = modifier@STG_rev_national_security_weekly_change_modifier}
            STG_rev_national_security_check = yes
            STG_action_point_recovery = yes
        }
    }
}
#安全状态检测
STG_rev_national_security_check = {
    hidden_effect = {
        STG = {
            clamp_variable = {
                var = STG_national_security
                max = 200
                min = 0
            }
            if = {
                limit = {
                    check_variable = {STG_national_security < 26}
                }
                set_variable = {STG_national_security_level = 1}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 25}
                    check_variable = {STG_national_security < 61}
                }
                set_variable = {STG_national_security_level = 2}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 60}
                    check_variable = {STG_national_security < 91}
                }
                set_variable = {STG_national_security_level = 3}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 90}
                    check_variable = {STG_national_security < 141}
                }
                set_variable = {STG_national_security_level = 4}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 140}
                    check_variable = {STG_national_security < 161}
                }
                set_variable = {STG_national_security_level = 5}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 160}
                    check_variable = {STG_national_security < 181}
                }
                set_variable = {STG_national_security_level = 6}
                STG_add_rev_national_security_idea = yes
            }
            else_if = {
                limit = {
                    check_variable = {STG_national_security > 180}
                }
                set_variable = {STG_national_security_level = 7}
                STG_add_rev_national_security_idea = yes
            }
        }
    }
}
#切换国家精神
STG_add_rev_national_security_idea = {
    hidden_effect = {
        STG = {
            remove_ideas = STG_rev_national_security_level_1
            remove_ideas = STG_rev_national_security_level_2
            remove_ideas = STG_rev_national_security_level_3
            remove_ideas = STG_rev_national_security_level_4
            remove_ideas = STG_rev_national_security_level_5
            remove_ideas = STG_rev_national_security_level_6
            remove_ideas = STG_rev_national_security_level_7
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 1}
                }
                add_ideas = STG_rev_national_security_level_1
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 2}
                }
                add_ideas = STG_rev_national_security_level_2
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 3}
                }
                add_ideas = STG_rev_national_security_level_3
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 4}
                }
                add_ideas = STG_rev_national_security_level_4
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 5}
                }
                add_ideas = STG_rev_national_security_level_5
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 6}
                }
                add_ideas = STG_rev_national_security_level_6
            }
            if = {
                limit = {
                    check_variable = {STG_national_security_level = 7}
                }
                add_ideas = STG_rev_national_security_level_7
            }
        }
    }
}
#行动点数恢复
STG_action_point_recovery = {
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_action_point_recovery_cooldown
                    }
                }
                add_to_variable = {STG_security_agency_action_point = 1}
                add_to_variable = {STG_armed_picket_action_point = 1}
                set_country_flag = {flag = STG_action_point_recovery_cooldown days = 180 value = 1}
            }
            clamp_variable = {
                var = STG_security_agency_action_point
                max = STG_security_agency_action_point_limit
                min = 0
            }
            clamp_variable = {
                var = STG_armed_picket_action_point
                max = STG_armed_picket_action_point_limit
                min = 0
            }
        }
    }
}
#纠察队效率恶化
STG_picket_level_worsen = {
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_picket_level_worsen_cooldown
                    }
                }
                add_to_variable = {STG_armed_picket_level = -1}
                set_country_flag = {flag = STG_picket_level_worsen_cooldown days = 270 value = 1}
            }
            clamp_variable = {
                var = STG_armed_picket_level
                max = 3
                min = 1
            }
        }
    }
}
#安全形势极度恶化
STG_rev_damage_security_very_big = {
    custom_effect_tooltip = STG_rev_damage_security_very_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = -15}
            add_to_variable = {STG_rev_national_security_weekly_change = -0.5}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#安全形势恶化
STG_rev_damage_security_big = {
    custom_effect_tooltip = STG_rev_damage_security_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = -5}
            add_to_variable = {STG_rev_national_security_weekly_change = -0.1}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#安全形势略微恶化
STG_rev_damage_security = {
    custom_effect_tooltip = STG_rev_damage_security_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = -2}
        }
    }
}
#安全形势略微好转
STG_rev_strengthen_security = {
    custom_effect_tooltip = STG_rev_strengthen_security_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = 2}
        }
    }
}
#安全形势好转
STG_rev_strengthen_security_big = {
    custom_effect_tooltip = STG_rev_strengthen_security_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = 5}
            add_to_variable = {STG_rev_national_security_weekly_change = 0.1}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#安全形势大幅好转
STG_rev_strengthen_security_very_big = {
    custom_effect_tooltip = STG_rev_strengthen_security_very_big_desc
    hidden_effect = {
        STG = {
            add_to_variable = {STG_national_security = 15}
            add_to_variable = {STG_rev_national_security_weekly_change = 0.5}
            set_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_weekly_change}
            add_to_variable = {STG_rev_national_security_weekly_change_display = STG_rev_national_security_picket}
        }
    }
}
#红线议会初始化
STG_rev_par_setup = {
    STG = {
        set_variable = {STG_labor_seat = 61}
        set_variable = {STG_labor_supporter = 61}
        set_variable = {STG_left_seat = 41}
        set_variable = {STG_left_supporter = 0}
        set_variable = {STG_sd_seat = 36}
        set_variable = {STG_sd_supporter = 0}
        set_variable = {STG_lsd_seat = 0}
        set_variable = {STG_lsd_supporter = 0}
        set_variable = {STG_dem_seat = 12}
        set_variable = {STG_dem_supporter = 0}
        set_variable = {STG_rev_par_seat = 150}
    }
}
#红线议会支持计算
STG_calculate_rev_par_support = {
    STG = {
        clamp_variable = {
            var = STG_labor_supporter
            max = STG_labor_seat
            min = 0
        }
        if = {
            limit = {check_variable = {STG_left_in_gov = 1}}
            clamp_variable = {
                var = STG_left_supporter
                max = STG_left_seat
                min = 4
            }
        }
        else = {
            clamp_variable = {
                var = STG_left_supporter
                max = STG_left_seat
                min = 0
            }
        }
        if = {
            limit = {check_variable = {STG_sd_in_gov = 1}}
            clamp_variable = {
                var = STG_sd_supporter
                max = STG_sd_seat
                min = 4
            }
        }
        else = {
            clamp_variable = {
                var = STG_sd_supporter
                max = STG_sd_seat
                min = 0
            }
        }
        clamp_variable = {
            var = STG_lsd_supporter
            max = STG_lsd_seat
            min = 0
        }
        clamp_variable = {
            var = STG_dem_supporter
            max = STG_dem_seat
            min = 0
        }
        set_variable = {STG_rev_par_support = 0}
        add_to_variable = {STG_rev_par_support = STG_labor_supporter}
        add_to_variable = {STG_rev_par_support = STG_left_supporter}
        add_to_variable = {STG_rev_par_support = STG_sd_supporter}
        add_to_variable = {STG_rev_par_support = STG_lsd_supporter}
        add_to_variable = {STG_rev_par_support = STG_dem_supporter}
    }
}
#红线随机失去支持
STG_rev_random_lose_a_supporter = {
    custom_effect_tooltip = STG_rev_random_lose_a_supporter_desc
    hidden_effect = {
        STG = {
            if = {
                limit = {
                    NOT = {
                        has_country_flag = STG_rev_sd_collapsed
                    }
                }
                if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    random_list = {
                        33 = {
                            add_to_variable = {STG_left_supporter = -1}
                        }
                        33 = {
                            add_to_variable = {STG_sd_supporter = -1}
                        }
                        33 = {
                            add_to_variable = {STG_dem_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter = 0}
                    }
                    random_list = {
                        50 = {
                            add_to_variable = {STG_left_supporter = -1}
                        }
                        50 = {
                            add_to_variable = {STG_sd_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter = 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    random_list = {
                        50 = {
                            add_to_variable = {STG_dem_supporter = -1}
                        }
                        50 = {
                            add_to_variable = {STG_sd_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter = 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    random_list = {
                        50 = {
                            add_to_variable = {STG_dem_supporter = -1}
                        }
                        50 = {
                            add_to_variable = {STG_left_supporter = -1}
                        }
                    }
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter > 0}
                        check_variable = {STG_sd_supporter = 0}
                        check_variable = {STG_dem_supporter = 0}
                    }
                    add_to_variable = {STG_left_supporter = -1}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter = 0}
                        check_variable = {STG_sd_supporter > 0}
                        check_variable = {STG_dem_supporter = 0}
                    }
                    add_to_variable = {STG_sd_supporter = -1}
                }
                else_if = {
                    limit = {
                        check_variable = {STG_left_supporter = 0}
                        check_variable = {STG_sd_supporter = 0}
                        check_variable = {STG_dem_supporter > 0}
                    }
                    add_to_variable = {STG_dem_supporter = -1}
                }
            }
            STG_calculate_rev_par_support = yes
        }
    }
}
#红线好感度计算
STG_rev_galgame_check = {
    STG = {
        clamp_variable = {
            var = STG_left_opinion
            max = 75
            min = 0
        }
        clamp_variable = {
            var = STG_sd_opinion
            max = 75
            min = 0
        }
        clamp_variable = {
            var = STG_dem_opinion
            max = 75
            min = 0
        }
        if = {
            limit = {
                check_variable = {STG_left_opinion > 50}
                NOT = {has_country_flag = STG_left_bonus_seat_cooldown}
            }
            add_to_variable = {STG_left_supporter = 1}
            set_country_flag = {flag = STG_left_bonus_seat_cooldown days = 120 value = 1}
        }
        if = {
            limit = {check_variable = {STG_left_opinion < 26}}
            add_to_variable = {STG_left_supporter = -1}
        }
        if = {
            limit = {
                check_variable = {STG_sd_opinion > 50}
                NOT = {has_country_flag = STG_sd_bonus_seat_cooldown}
            }
            add_to_variable = {STG_sd_supporter = 1}
            set_country_flag = {flag = STG_sd_bonus_seat_cooldown days = 120 value = 1}
        }
        if = {
            limit = {check_variable = {STG_sd_opinion < 26}}
            add_to_variable = {STG_sd_supporter = -1}
        }
        if = {
            limit = {
                check_variable = {STG_dem_opinion > 50}
                NOT = {has_country_flag = STG_dem_bonus_seat_cooldown}
            }
            add_to_variable = {STG_dem_supporter = 1}
            set_country_flag = {flag = STG_dem_bonus_seat_cooldown days = 120 value = 1}
        }
        if = {
            limit = {check_variable = {STG_dem_opinion < 26}}
            add_to_variable = {STG_dem_supporter = -1}
        }
        STG_calculate_rev_par_support = yes
    }
}
STG_rev_support_labor_effect = {
    if = {
        limit = {
            check_variable = {STG_rev_support_labor_temp < 0}
        }
        custom_effect_tooltip = STG_rev_support_labor_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_rev_support_labor_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_labor_supporter = STG_rev_support_labor_temp}
        clamp_variable = {
            var = STG_labor_supporter
            max = STG_labor_seat
            min = 0
        }
    }
}
STG_rev_support_left_effect = {
    if = {
        limit = {
            check_variable = {STG_rev_support_left_temp < 0}
        }
        custom_effect_tooltip = STG_rev_support_left_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_rev_support_left_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_left_supporter = STG_rev_support_left_temp}
        clamp_variable = {
            var = STG_left_supporter
            max = STG_left_seat
            min = 0
        }
    }
}
STG_rev_support_sd_effect = {
    if = {
        limit = {
            check_variable = {STG_rev_support_sd_temp < 0}
        }
        custom_effect_tooltip = STG_rev_support_sd_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_rev_support_sd_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_sd_supporter = STG_rev_support_sd_temp}
        clamp_variable = {
            var = STG_sd_supporter
            max = STG_sd_seat
            min = 0
        }
    }
}
STG_rev_support_dem_effect = {
    if = {
        limit = {
            check_variable = {STG_rev_support_dem_temp < 0}
        }
        custom_effect_tooltip = STG_rev_support_dem_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_rev_support_dem_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_labor_supporter = STG_rev_support_dem_temp}
        clamp_variable = {
            var = STG_dem_supporter
            max = STG_dem_seat
            min = 0
        }
    }
}
STG_left_opinion_effect = {
    if = {
        limit = {
            check_variable = {STG_left_opinion_temp < 0}
        }
        custom_effect_tooltip = STG_left_opinion_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_left_opinion_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_left_opinion = STG_left_opinion_temp}
        clamp_variable = {
            var = STG_left_opinion
            max = 75
            min = 0
        }
    }
}
STG_sd_opinion_effect = {
    if = {
        limit = {
            check_variable = {STG_sd_opinion_temp < 0}
        }
        custom_effect_tooltip = STG_sd_opinion_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_sd_opinion_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_sd_opinion = STG_sd_opinion_temp}
        clamp_variable = {
            var = STG_sd_opinion
            max = 75
            min = 0
        }
    }
}
STG_dem_opinion_effect = {
    if = {
        limit = {
            check_variable = {STG_dem_opinion_temp < 0}
        }
        custom_effect_tooltip = STG_dem_opinion_effect_desc_1
    }
    else = {
        custom_effect_tooltip = STG_dem_opinion_effect_desc_2
    }
    hidden_effect = {
        add_to_variable = {STG_left_opinion = STG_dem_opinion_temp}
        clamp_variable = {
            var = STG_dem_opinion
            max = 75
            min = 0
        }
    }
}

STG_add_evidence_5 = {
    custom_effect_tooltip = STG_add_evidence_5_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_com_evidence = 10}}
    }
}
STG_add_evidence_10 = {
    custom_effect_tooltip = STG_add_evidence_10_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_com_evidence = 10}}
    }
}
STG_add_evidence_30 = {
    custom_effect_tooltip = STG_add_evidence_30_desc
    hidden_effect = {
        STG = {add_to_variable = {STG_com_evidence = 30}}
    }
}
STG_clear_state_flag = {
    STG = {
        every_core_state = {
            clr_state_flag = normal_seats_flag
            clr_state_flag = new_england_special_seats_flag
            clr_state_flag = einzbern_seats_flag
        }
    }
}
STG_shipbuilding_setup = {
    custom_effect_tooltip = STG_unlock_shipbuilding
    set_country_flag = STG_unlock_shipbuilding_flag
    create_equipment_variant = {
		name = "机动级"
		type = ship_hull_light_2
		parent_version = 0
		modules = {
			fixed_ship_battery_slot = ship_light_battery_2
			fixed_ship_anti_air_slot = ship_anti_air_1
			fixed_ship_fire_control_system_slot = ship_fire_control_system_0
			fixed_ship_radar_slot = ship_sonar_1
			fixed_ship_engine_slot = light_ship_engine_2
			fixed_ship_torpedo_slot = ship_torpedo_1
			mid_1_custom_slot = ship_torpedo_1
			rear_1_custom_slot = ship_depth_charge_1
		}
	}
    if = {
        limit = {
            has_government = communism
        }
        create_equipment_variant = {
            name = "五月起义级"
            type = ship_hull_heavy_1
            parent_version = 0
            allow_without_tech = yes
            modules = {
                fixed_ship_battery_slot = ship_heavy_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_1
                fixed_ship_fire_control_system_slot = ship_fire_control_system_1
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = heavy_ship_engine_2
                fixed_ship_secondaries_slot = dp_ship_secondaries_2
                fixed_ship_armor_slot = ship_armor_bc_2
                front_1_custom_slot = ship_heavy_battery_1
                mid_1_custom_slot = ship_anti_air_1
                mid_2_custom_slot = ship_secondaries_1
                rear_1_custom_slot = ship_heavy_battery_2
            }
        }
        create_equipment_variant = {
            name = "焰火级"
            type = ship_hull_cruiser_2
            allow_without_tech = yes
            parent_version = 0
            modules = {
                fixed_ship_battery_slot = ship_light_medium_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_2
                fixed_ship_fire_control_system_slot = ship_fire_control_system_0
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = cruiser_ship_engine_2
                fixed_ship_armor_slot = ship_armor_cruiser_2
                front_1_custom_slot = ship_anti_air_2
                mid_1_custom_slot = ship_torpedo_1
                mid_2_custom_slot = ship_secondaries_2
                rear_1_custom_slot = ship_light_medium_battery_2
            }
        }
    }
    else = {
        create_equipment_variant = {
            name = "加里波莉级"
            type = ship_hull_heavy_1
            parent_version = 0
            allow_without_tech = yes
            modules = {
                fixed_ship_battery_slot = ship_heavy_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_1
                fixed_ship_fire_control_system_slot = ship_fire_control_system_1
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = heavy_ship_engine_2
                fixed_ship_secondaries_slot = dp_ship_secondaries_2
                fixed_ship_armor_slot = ship_armor_bc_2
                front_1_custom_slot = ship_heavy_battery_1
                mid_1_custom_slot = ship_anti_air_1
                mid_2_custom_slot = ship_secondaries_1
                rear_1_custom_slot = ship_heavy_battery_2
            }
        }
        create_equipment_variant = {
            name = "剑鞘级"
            type = ship_hull_cruiser_2
            allow_without_tech = yes
            parent_version = 0
            modules = {
                fixed_ship_battery_slot = ship_light_medium_battery_2
                fixed_ship_anti_air_slot = ship_anti_air_2
                fixed_ship_fire_control_system_slot = ship_fire_control_system_0
                fixed_ship_radar_slot = empty
                fixed_ship_engine_slot = cruiser_ship_engine_2
                fixed_ship_armor_slot = ship_armor_cruiser_2
                front_1_custom_slot = ship_anti_air_2
                mid_1_custom_slot = ship_torpedo_1
                mid_2_custom_slot = ship_secondaries_2
                rear_1_custom_slot = ship_light_medium_battery_2
            }
        }
    }
}
STG_add_landing_plan_5 = {
    custom_effect_tooltip = STG_add_landing_plan_5_desc
    add_to_variable = {STG.STG_landing_plan = 5}
}
STG_add_landing_plan_10 = {
    custom_effect_tooltip = STG_add_landing_plan_10_desc
    add_to_variable = {STG.STG_landing_plan = 10}
}
STG_add_landing_plan_15 = {
    custom_effect_tooltip = STG_add_landing_plan_15_desc
    add_to_variable = {STG.STG_landing_plan = 15}
}
STG_ways_of_st_gloriana_bonus_setup = {
    hidden_effect = {
        STG = {
            set_variable = {STG_ways_of_st_gloriana_army_attack_factor_t = 0.01}
            set_variable = {STG_ways_of_st_gloriana_army_defence_factor_t = 0.01}
            set_variable = {STG_ways_of_st_gloriana_breakthrough_factor_t = 0.02}
            set_variable = {STG_ways_of_st_gloriana_army_org_factor_t = 0.02}
            set_variable = {STG_ways_of_st_gloriana_army_attack_factor = STG_ways_of_st_gloriana_army_attack_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_defence_factor = STG_ways_of_st_gloriana_army_defence_factor_t}
            set_variable = {STG_ways_of_st_gloriana_breakthrough_factor = STG_ways_of_st_gloriana_breakthrough_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_org_factor = STG_ways_of_st_gloriana_army_org_factor_t}
        }
    }
}
STG_ways_of_st_gloriana_bonus_update = {
    hidden_effect = {
        STG = {
            set_variable = {STG_ways_of_st_gloriana_skill_counter = 0}
            set_variable = {STG_ways_of_st_gloriana_armor_counter = 0}
            set_variable = {STG_ways_of_st_gloriana_infantry_counter = 0}
            every_unit_leader = {
                if = {
                    limit = {
                        OR = {
                            has_trait = STG_Reformists_Trait
                            has_trait = STG_Academic_Trait
                            has_trait = STG_Shimada_Trait
                        }
                    }
                    if = {
                        limit = {
                            skill > 3
                        }
                        add_to_variable = {STG.STG_ways_of_st_gloriana_skill_counter = 1}
                    }
                    if = {
                        limit = {
                            has_trait = armor_officer
                        }
                        add_to_variable = {STG.STG_ways_of_st_gloriana_armor_counter = 1}
                    }
                    if = {
                        limit = {
                            has_trait = infantry_officer
                        }
                        add_to_variable = {STG.STG_ways_of_st_gloriana_infantry_counter = 1}
                    }
                }
            }
            set_variable = {STG_ways_of_st_gloriana_army_attack_factor = STG_ways_of_st_gloriana_army_attack_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_defence_factor = STG_ways_of_st_gloriana_army_defence_factor_t}
            set_variable = {STG_ways_of_st_gloriana_breakthrough_factor = STG_ways_of_st_gloriana_breakthrough_factor_t}
            set_variable = {STG_ways_of_st_gloriana_army_org_factor = STG_ways_of_st_gloriana_army_org_factor_t}
            multiply_variable = {STG_ways_of_st_gloriana_army_attack_factor = STG_ways_of_st_gloriana_skill_counter}
            multiply_variable = {STG_ways_of_st_gloriana_army_defence_factor = STG_ways_of_st_gloriana_skill_counter}
            multiply_variable = {STG_ways_of_st_gloriana_breakthrough_factor = STG_ways_of_st_gloriana_armor_counter}
            multiply_variable = {STG_ways_of_st_gloriana_army_org_factor = STG_ways_of_st_gloriana_infantry_counter}
            if = {
                limit = {
                    is_puppet = no
                    is_in_faction = yes
                    has_idea = USR_senshado_alliance_idea
                }
                set_variable = {STG_ways_of_st_gloriana_industrial_capacity_factory = 0.1}
                set_variable = {STG_ways_of_st_gloriana_army_core_attack_factor = 0}
                set_variable = {STG_ways_of_st_gloriana_army_core_defence_factor = 0}
            }
            else = {
                set_variable = {STG_ways_of_st_gloriana_industrial_capacity_factory = 0}
                set_variable = {STG_ways_of_st_gloriana_army_core_attack_factor = 0.1}
                set_variable = {STG_ways_of_st_gloriana_army_core_defence_factor = 0.1}
            }
        }
    }
}