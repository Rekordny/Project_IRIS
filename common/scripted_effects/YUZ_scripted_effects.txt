#提高声誉
YUZ_improve_reputation = {
    custom_effect_tooltip = YUZ_improve_reputation_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = {YUZ_reputation = 1}
            YUZ_check_reputaion = yes
        }
    }
}
#大大提高声誉
YUZ_improve_reputation_big = {
    custom_effect_tooltip = YUZ_improve_reputation_big_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = {YUZ_reputation = 2}
            YUZ_check_reputaion = yes
        }
    }
}
#降低声誉
YUZ_damage_reputation = {
    custom_effect_tooltip = YUZ_damage_reputation_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = {YUZ_reputation = -1}
            YUZ_check_reputaion = yes
        }
    }
}
#大大降低声誉
YUZ_damage_reputation_big = {
    custom_effect_tooltip = YUZ_damage_reputation_big_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = {YUZ_reputation = -2}
            YUZ_check_reputaion = yes
        }
    }
}
#检测声誉
YUZ_check_reputaion = {
    YUZ = {
        clamp_variable = {
            var = YUZ_reputation
            max = 7
            min = 1
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 1}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_1
                    }
                }
                add_ideas = YUZ_reputation_1
            }
            remove_ideas = YUZ_reputation_2
            remove_ideas = YUZ_reputation_3
            remove_ideas = YUZ_reputation_4
            remove_ideas = YUZ_reputation_5
            remove_ideas = YUZ_reputation_6
            remove_ideas = YUZ_reputation_7
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 2}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_2
                    }
                }
                add_ideas = YUZ_reputation_2
            }
            remove_ideas = YUZ_reputation_1
            remove_ideas = YUZ_reputation_3
            remove_ideas = YUZ_reputation_4
            remove_ideas = YUZ_reputation_5
            remove_ideas = YUZ_reputation_6
            remove_ideas = YUZ_reputation_7
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 3}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_3
                    }
                }
                add_ideas = YUZ_reputation_3
            }
            remove_ideas = YUZ_reputation_1
            remove_ideas = YUZ_reputation_2
            remove_ideas = YUZ_reputation_4
            remove_ideas = YUZ_reputation_5
            remove_ideas = YUZ_reputation_6
            remove_ideas = YUZ_reputation_7
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 4}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_4
                    }
                }
                add_ideas = YUZ_reputation_4
            }
            remove_ideas = YUZ_reputation_1
            remove_ideas = YUZ_reputation_2
            remove_ideas = YUZ_reputation_3
            remove_ideas = YUZ_reputation_5
            remove_ideas = YUZ_reputation_6
            remove_ideas = YUZ_reputation_7
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 5}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_5
                    }
                }
                add_ideas = YUZ_reputation_5
            }
            remove_ideas = YUZ_reputation_1
            remove_ideas = YUZ_reputation_2
            remove_ideas = YUZ_reputation_3
            remove_ideas = YUZ_reputation_4
            remove_ideas = YUZ_reputation_6
            remove_ideas = YUZ_reputation_7
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 6}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_6
                    }
                }
                add_ideas = YUZ_reputation_6
            }
            remove_ideas = YUZ_reputation_1
            remove_ideas = YUZ_reputation_2
            remove_ideas = YUZ_reputation_3
            remove_ideas = YUZ_reputation_4
            remove_ideas = YUZ_reputation_5
            remove_ideas = YUZ_reputation_7
        }
        if = {
            limit = {
                YUZ = {check_variable = {YUZ_reputation = 7}}
            }
            if = {
                limit = {
                    NOT = {
                        has_idea = YUZ_reputation_7
                    }
                }
                add_ideas = YUZ_reputation_7
            }
            remove_ideas = YUZ_reputation_1
            remove_ideas = YUZ_reputation_2
            remove_ideas = YUZ_reputation_3
            remove_ideas = YUZ_reputation_4
            remove_ideas = YUZ_reputation_5
            remove_ideas = YUZ_reputation_6
        }
    }
}
#发售游戏
YUZ_sell_game_effect = {
    custom_effect_tooltip = YUZ_sell_game_effect_desc
        hidden_effect = {
            YUZ = {
                if = {
                    limit = {
                        #长篇无剧情废萌达咩
                        YUZ = {
                            has_country_flag = YUZ_select_r18_game
                            has_country_flag = YUZ_select_long_game
                            has_country_flag = YUZ_select_cute
                        }
                    }
                    every_country = {
                        add_to_variable = {YUZ_land_reinforce_rate = 0.02}
                        add_to_variable = {YUZ_army_attack_factor = 0.02}
                        add_to_variable = {YUZ_army_defence_factor = 0.02}
                        add_to_variable = {YUZ_army_morale_factor = 0.02}
                        add_to_variable = {YUZ_conscription_factor = 0.02}
                    }
                }
                if = {
                    limit = {
                        #胃疼死了！
                        YUZ = {
                            has_country_flag = YUZ_select_long_game
                            has_country_flag = YUZ_select_wa
                        }
                    }
                    every_country = {
                        add_to_variable = {YUZ_land_reinforce_rate = -0.02}
                        add_to_variable = {YUZ_army_attack_factor = -0.01}
                        add_to_variable = {YUZ_army_defence_factor = -0.01}
                        add_to_variable = {YUZ_army_morale_factor = -0.05}
                    }
                }
                every_country = {
                    set_variable_to_random = {
                        var = YUZ_game_random_quality
                        max = 1.5 
                        min = 0.75
                    }
                    multiply_variable = {YUZ_land_reinforce_rate = YUZ_game_random_quality}
                    multiply_variable = {YUZ_army_attack_factor = YUZ_game_random_quality}
                    multiply_variable = {YUZ_army_defence_factor = YUZ_game_random_quality}
                    multiply_variable = {YUZ_army_morale_factor = YUZ_game_random_quality}
                    multiply_variable = {YUZ_conscription_factor = YUZ_game_random_quality}
                }    
                every_neighbor_country = {
                    limit = {
                        NOT = {tag = YUZ}
                        NOT = {tag = RLN}
                        NOT = {is_in_faction_with = YUZ}
                        NOT = {has_war_with = YUZ}
                        NOT = {has_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier}}
                    }
                    add_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier days = 90}
                }
                random_country = {
                    limit = {
                        NOT = {tag = YUZ}
                        NOT = {tag = RLN}
                        NOT = {is_in_faction_with = YUZ}
                        NOT = {has_war_with = YUZ}
                        NOT = {has_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier}}
                    }
                    add_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier days = 90}
                }
                random_country = {
                    limit = {
                        NOT = {tag = YUZ}
                        NOT = {tag = RLN}
                        NOT = {is_in_faction_with = YUZ}
                        NOT = {has_war_with = YUZ}
                        NOT = {has_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier}}
                    }
                    add_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier days = 90}
                }
                random_country = {
                    limit = {
                        NOT = {tag = YUZ}
                        NOT = {tag = RLN}
                        NOT = {is_in_faction_with = YUZ}
                        NOT = {has_war_with = YUZ}
                        NOT = {has_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier}}
                    }
                    add_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier days = 90}
                }
                random_country = {
                    limit = {
                        NOT = {tag = YUZ}
                        NOT = {tag = RLN}
                        NOT = {is_in_faction_with = YUZ}
                        NOT = {has_war_with = YUZ}
                        NOT = {has_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier}}
                    }
                    add_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier days = 90}
                }
                random_country = {
                    limit = {
                        NOT = {tag = YUZ}
                        NOT = {tag = RLN}
                        NOT = {is_in_faction_with = YUZ}
                        NOT = {has_war_with = YUZ}
                        NOT = {has_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier}}
                    }
                    add_dynamic_modifier = {modifier = YUZ_galgame_dynamic_modifier days = 90}
                }
            set_country_flag = {flag = YUZ_galgame_recently_sold days = 180 value = 1}
            clr_country_flag = YUZ_start
            clr_country_flag = YUZ_got_extra_time
            clr_country_flag = YUZ_game_dev_started
            clr_country_flag = YUZ_select_wa
            clr_country_flag = YUZ_galgame_type_selected
            clr_country_flag = YUZ_select_story
            clr_country_flag = YUZ_select_cute
            clr_country_flag = YUZ_galgame_type_selected
            clr_country_flag = YUZ_select_long_game
            clr_country_flag = YUZ_galgame_length_selected
            clr_country_flag = YUZ_select_middle_game
            clr_country_flag = YUZ_select_short_game
            clr_country_flag = YUZ_select_r18_game
            clr_country_flag = YUZ_galgame_age_selected
            clr_country_flag = YUZ_select_normal_game
            YUZ_final_result = yes
        }
    }
}
#全部初始化
YUZ_initialize_all = {
    YUZ = {
        YUZ_initialize_plot_quality = yes
        YUZ_initialize_cg_quality = yes
        YUZ_initialize_music_quality = yes
        YUZ_initialize_program_quality = yes
        YUZ_initialize_expectation_quality = yes
        YUZ_calculate_quality = yes
    }
}
#剧本质量初始化
YUZ_initialize_plot_quality = {
    YUZ = {
        if = {
            limit = {
                has_country_flag = YUZ_select_normal_game
            }
            set_variable_to_random = {
                var = YUZ_plot
                max = 70
                min = 40
            }
        }
        else = {
            set_variable_to_random = {
                var = YUZ_plot
                max = 60
                min = 30
            }
        }
        if = {
            limit = {
                has_country_flag = YUZ_select_short_game
            }
            YUZ = {
                add_to_variable = {YUZ_plot = 10}
            }
        }
        if = {
            limit = {
                has_country_flag = YUZ_select_long_game
            }
            YUZ = {
                add_to_variable = {YUZ_plot = -10}
            }
        }
    }
}
#CG质量初始化
YUZ_initialize_cg_quality = {
    YUZ = {
        set_variable_to_random = {
            var = YUZ_cg
            max = 80
            min = 40
        }
    }
}
#音乐质量初始化
YUZ_initialize_music_quality = {
    YUZ = {
        set_variable_to_random = {
            var = YUZ_music
            max = 90
            min = 40
        }
    }
}
#程序质量初始化
YUZ_initialize_program_quality = {
    YUZ = {
        set_variable_to_random = {
            var = YUZ_program
            max = 80
            min = 50
        }
    }
}
#期望初始化
YUZ_initialize_expectation_quality = {
    YUZ = {
        set_variable_to_random = {
            var = YUZ_expectation
            max = 100
            min = 50
        }
        if = {
            limit = {
                has_country_flag = YUZ_select_r18_game
            }
            YUZ = {
                add_to_variable = {YUZ_expectation = 7}
            }
        }
    }
}
#提高剧本质量
YUZ_improve_plot = {
    custom_effect_tooltip = YUZ_improve_plot_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_plot = 4}
            YUZ_calculate_quality = yes
        }
    }
}
#提高剧本质量
YUZ_improve_plot_small = {
    custom_effect_tooltip = YUZ_improve_plot_small_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_plot = 2}
            YUZ_calculate_quality = yes
        }
    }
}
#提高CG质量
YUZ_improve_cg = {
    custom_effect_tooltip = YUZ_improve_cg_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_cg = 4}
            YUZ_calculate_quality = yes
        }
    }
}
#提高CG质量
YUZ_improve_cg_small = {
    custom_effect_tooltip = YUZ_improve_cg_small_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_cg = 2}
            YUZ_calculate_quality = yes
        }
    }
}
#提高音乐质量
YUZ_improve_music = {
    custom_effect_tooltip = YUZ_improve_music_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_music = 4}
            YUZ_calculate_quality = yes
        }
    }
}
#提高音乐质量
YUZ_improve_music_small = {
    custom_effect_tooltip = YUZ_improve_plot_music_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_music = 2}
            YUZ_calculate_quality = yes
        }
    }
}
#提高程序质量
YUZ_improve_program = {
    custom_effect_tooltip = YUZ_improve_program_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_program = 4}
            YUZ_calculate_quality = yes
        }
    }
}
#提高程序质量
YUZ_improve_program_small = {
    custom_effect_tooltip = YUZ_improve_plot_program_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_program = 2}
            YUZ_calculate_quality = yes
        }
    }
}
#提高市场预期
YUZ_improve_expectation = {
    custom_effect_tooltip = YUZ_improve_expectation_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_expectation = 4}
            YUZ_calculate_quality = yes
        }
    }
}
#提高市场预期
YUZ_improve_expectation_small = {
    custom_effect_tooltip = YUZ_improve_plot_expectation_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_expectation = 2}
            YUZ_calculate_quality = yes
        }
    }
}
#降低市场预期
YUZ_decrease_expectation = {
    custom_effect_tooltip = YUZ_decrease_expectation_desc
    hidden_effect = {
        YUZ = {
            add_to_variable = { YUZ_expectation = -5}
            YUZ_calculate_quality = yes
        }
    }
}
#计算平均质量
YUZ_calculate_quality = {
    hidden_effect = {
        YUZ = {
            set_variable = {YUZ_game_total_quality = 0}#加权平均
            set_variable = {YUZ_plot_t = YUZ_plot}
            set_variable = {YUZ_music_t = YUZ_music}
            set_variable = {YUZ_cg_t = YUZ_cg}
            set_variable = {YUZ_program_t = YUZ_program}
            set_variable = {YUZ_expectation_t = YUZ_expectation}
            multiply_variable = {YUZ_plot_t = 0.30}
            multiply_variable = {YUZ_music_t = 0.20}
            multiply_variable = {YUZ_cg_t = 0.25}
            multiply_variable = {YUZ_program_t = 0.10}
            multiply_variable = {YUZ_expectation_t = 0.15}
            add_to_variable = {YUZ_game_total_quality = YUZ_plot_t}
            add_to_variable = {YUZ_game_total_quality = YUZ_music_t}
            add_to_variable = {YUZ_game_total_quality = YUZ_cg_t}
            add_to_variable = {YUZ_game_total_quality = YUZ_program_t}
            add_to_variable = {YUZ_game_total_quality = YUZ_expectation_t}
            YUZ_calculate_income = yes
        }
    }
}
#最终结果
YUZ_final_result = {
    hidden_effect = {
        YUZ = {
            if = {
                limit = {
                    check_variable = {YUZ_game_total_quality > 89}
                }
                country_event = {id = YUZ_game.1 days = 3}
            }
            if = {
                limit = {
                    check_variable = {YUZ_game_total_quality > 79}
                    check_variable = {YUZ_game_total_quality < 90}
                }
                country_event = {id = YUZ_game.2 days = 3}
            }
            if = {
                limit = {
                    check_variable = {YUZ_game_total_quality > 69}
                    check_variable = {YUZ_game_total_quality < 80}
                }
                country_event = {id = YUZ_game.3 days = 3}
            }
            if = {
                limit = {
                    check_variable = {YUZ_game_total_quality > 59}
                    check_variable = {YUZ_game_total_quality < 70}
                }
                country_event = {id = YUZ_game.4 days = 3}
            }
            if = {
                limit = {
                    check_variable = {YUZ_game_total_quality < 60}
                }
                country_event = {id = YUZ_game.5 days = 3}
            }
        }
    }
}
#结算收入
YUZ_calculate_income = {
    YUZ = {
        hidden_effect = {    
            set_variable = {YUZ_income = YUZ_game_total_quality}
            multiply_variable = {YUZ_income = 200}
        }
    }
}
YUZ_income = {
    YUZ = {
        add_cic = YUZ_income
    }
}