scripted_gui = {
    KNK_shipbuild_window = {
        context_type = player_context
		parent_window_token = top_bar
        window_name = "KNK_shipbuild_window"

        visible = {
			tag = KNK
            check_variable = {KNK_gui_window_var = 1}            
		}

        triggers = {
            KNK_dock1_get_ship_visible = {
                has_country_flag = KNK_dock1_occupied
                check_variable = {KNK_dock1_days = 0}
            }
            KNK_dock2_get_ship_visible = {
                has_country_flag = KNK_dock2_occupied
                check_variable = {KNK_dock2_days = 0}
            }
            KNK_dock3_get_ship_visible = {
                has_country_flag = KNK_dock3_occupied
                check_variable = {KNK_dock3_days = 0}
            }
            KNK_dock4_get_ship_visible = {
                has_country_flag = KNK_dock4_occupied
                check_variable = {KNK_dock4_days = 0}
            }
            KNK_dock1_start_build_visible = {
                NOT = {
                    has_country_flag = KNK_dock1_occupied
                }
            }
            KNK_dock2_start_build_visible = {
                NOT = {
                    has_country_flag = KNK_dock2_occupied
                }
            }
            KNK_dock3_start_build_visible = {
                NOT = {
                    has_country_flag = KNK_dock3_occupied
                }
                has_country_flag = KNK_dock3_available
            }
            KNK_dock4_start_build_visible = {
                NOT = {
                    has_country_flag = KNK_dock4_occupied
                }
                has_country_flag = KNK_dock4_available
            }
            KNK_dock1_phase_1_visible = {
                has_country_flag = KNK_dock1_occupied
            }
            KNK_dock1_phase_2_visible = {
                has_country_flag = KNK_dock1_occupied
                check_variable = {KNK_dock1_p > 0}
            }
            KNK_dock1_phase_3_visible = {
                has_country_flag = KNK_dock1_occupied
                check_variable = {KNK_dock1_p > 1}
            }
            KNK_dock1_phase_4_visible = {
                has_country_flag = KNK_dock1_occupied
                check_variable = {KNK_dock1_p > 2}
            }
            KNK_dock1_phase_5_visible = {
                has_country_flag = KNK_dock1_occupied
                check_variable = {KNK_dock1_days = 0}
            }
            
            KNK_dock2_phase_1_visible = {
                has_country_flag = KNK_dock2_occupied
            }
            KNK_dock2_phase_2_visible = {
                has_country_flag = KNK_dock2_occupied
                check_variable = {KNK_dock2_p > 0}
            }
            KNK_dock2_phase_3_visible = {
                has_country_flag = KNK_dock2_occupied
                check_variable = {KNK_dock2_p > 1}
            }
            KNK_dock2_phase_4_visible = {
                has_country_flag = KNK_dock2_occupied
                check_variable = {KNK_dock2_p > 2}
            }
            KNK_dock2_phase_5_visible = {
                has_country_flag = KNK_dock2_occupied
                check_variable = {KNK_dock2_days = 0}
            }

            KNK_dock3_phase_1_visible = {
                has_country_flag = KNK_dock3_occupied
            }
            KNK_dock3_phase_2_visible = {
                has_country_flag = KNK_dock3_occupied
                check_variable = {KNK_dock3_p > 0}
            }
            KNK_dock3_phase_3_visible = {
                has_country_flag = KNK_dock3_occupied
                check_variable = {KNK_dock3_p > 1}
            }
            KNK_dock3_phase_4_visible = {
                has_country_flag = KNK_dock3_occupied
                check_variable = {KNK_dock3_p > 2}
            }
            KNK_dock3_phase_5_visible = {
                has_country_flag = KNK_dock3_occupied
                check_variable = {KNK_dock3_days = 0}
            }

            KNK_dock4_phase_1_visible = {
                has_country_flag = KNK_dock4_occupied
            }
            KNK_dock4_phase_2_visible = {
                has_country_flag = KNK_dock4_occupied
                check_variable = {KNK_dock4_p > 0}
            }
            KNK_dock4_phase_3_visible = {
                has_country_flag = KNK_dock4_occupied
                check_variable = {KNK_dock4_p > 1}
            }
            KNK_dock4_phase_4_visible = {
                has_country_flag = KNK_dock4_occupied
                check_variable = {KNK_dock4_p > 2}
            }
            KNK_dock4_phase_5_visible = {
                has_country_flag = KNK_dock4_occupied
                check_variable = {KNK_dock4_days = 0}
            }
            KNK_dock3_unavailable_visible = {
                NOT = {
                    has_country_flag = KNK_dock3_available
                }
            }
            KNK_dock4_unavailable_visible = {
                NOT = {
                    has_country_flag = KNK_dock4_available
                }
            }
        }

        effects = {
            KNK_dock1_start_build_click = {
                set_variable = {KNK_dock_var = 1}
                set_variable = {KNK_gui_window_2_var = 1}
            }
            KNK_dock2_start_build_click = {
                set_variable = {KNK_dock_var = 2}
                set_variable = {KNK_gui_window_2_var = 1}
            }
            KNK_dock3_start_build_click = {
                set_variable = {KNK_dock_var = 3}
                set_variable = {KNK_gui_window_2_var = 1}
            }
            KNK_dock4_start_build_click = {
                set_variable = {KNK_dock_var = 4}
                set_variable = {KNK_gui_window_2_var = 1}
            }
            KNK_dock1_get_ship_click = {
                set_variable = {KNK_dock_var = 1}
                set_variable = {KNK_dock1_p = 0}
                KNK_get_ship_effect = yes
                clr_country_flag = KNK_dock1_occupied
                sound_effect = "KNK_complete"
            }
            KNK_dock2_get_ship_click = {
                set_variable = {KNK_dock_var = 2}
                set_variable = {KNK_dock2_p = 0}
                KNK_get_ship_effect = yes
                clr_country_flag = KNK_dock2_occupied
                sound_effect = "KNK_complete"
            }
            KNK_dock3_get_ship_click = {
                set_variable = {KNK_dock_var = 3}
                set_variable = {KNK_dock3_p = 0}
                KNK_get_ship_effect = yes
                clr_country_flag = KNK_dock3_occupied
                sound_effect = "KNK_complete"
            }
            KNK_dock4_get_ship_click = {
                set_variable = {KNK_dock_var = 4}
                set_variable = {KNK_dock4_p = 0}
                KNK_get_ship_effect = yes
                clr_country_flag = KNK_dock4_occupied
                sound_effect = "KNK_complete"
            }
        }
    }
    KNK_shipbuild_window_2 = {
        context_type = player_context
        parent_window_token = "KNK_shipbuild_window"
        window_name = "KNK_shipbuild_window_2"

        visible = {
            tag = KNK
            check_variable = {KNK_gui_window_2_var = 1}
        }

        properties = {
            KNK_tips = {
                image = "[KNK_tip_scripted_loc]"
            }
        }

        effects = {
            KNK_close_button_click = {
                set_variable = {KNK_gui_window_2_var = 0}
            }

            KNK_fuel_add_1_button_click = {
                add_to_variable = {KNK_fuel_input = 1}
                KNK_clamp_input = yes
            }
            KNK_fuel_minus_1_button_click = {
                add_to_variable = {KNK_fuel_input = -1}
                KNK_clamp_input = yes
            }
            KNK_fuel_add_10_button_click = {
                add_to_variable = {KNK_fuel_input = 10}
                KNK_clamp_input = yes
            }
            KNK_fuel_minus_10_button_click = {
                add_to_variable = {KNK_fuel_input = -10}
                KNK_clamp_input = yes
            }
            KNK_fuel_add_100_button_click = {
                add_to_variable = {KNK_fuel_input = 100}
                KNK_clamp_input = yes
            }
            KNK_fuel_minus_100_button_click = {
                add_to_variable = {KNK_fuel_input = -100}
                KNK_clamp_input = yes
            }
            KNK_fuel_reset_button_click = {
                set_variable = {KNK_fuel_input = 0}
            }
            KNK_fuel_max_button_click = {
                set_variable = {KNK_fuel_input = KNK_fuel}
                KNK_clamp_input = yes
            }

            KNK_ammo_add_1_button_click = {
                add_to_variable = {KNK_ammo_input = 1}
                KNK_clamp_input = yes
            }
            KNK_ammo_minus_1_button_click = {
                add_to_variable = {KNK_ammo_input = -1}
                KNK_clamp_input = yes
            }
            KNK_ammo_add_10_button_click = {
                add_to_variable = {KNK_ammo_input = 10}
                KNK_clamp_input = yes
            }
            KNK_ammo_minus_10_button_click = {
                add_to_variable = {KNK_ammo_input = -10}
                KNK_clamp_input = yes
            }
            KNK_ammo_add_100_button_click = {
                add_to_variable = {KNK_ammo_input = 100}
                KNK_clamp_input = yes
            }
            KNK_ammo_minus_100_button_click = {
                add_to_variable = {KNK_ammo_input = -100}
                KNK_clamp_input = yes
            }
            KNK_ammo_reset_button_click = {
                set_variable = {KNK_ammo_input = 0}
            }
            KNK_ammo_max_button_click = {
                set_variable = {KNK_ammo_input = KNK_ammo}
                KNK_clamp_input = yes
            }

            KNK_steel_add_1_button_click = {
                add_to_variable = {KNK_steel_input = 1}
                KNK_clamp_input = yes
            }
            KNK_steel_minus_1_button_click = {
                add_to_variable = {KNK_steel_input = -1}
                KNK_clamp_input = yes
            }
            KNK_steel_add_10_button_click = {
                add_to_variable = {KNK_steel_input = 10}
                KNK_clamp_input = yes
            }
            KNK_steel_minus_10_button_click = {
                add_to_variable = {KNK_steel_input = -10}
                KNK_clamp_input = yes
            }
            KNK_steel_add_100_button_click = {
                add_to_variable = {KNK_steel_input = 100}
                KNK_clamp_input = yes
            }
            KNK_steel_minus_100_button_click = {
                add_to_variable = {KNK_steel_input = -100}
                KNK_clamp_input = yes
            }
            KNK_steel_reset_button_click = {
                set_variable = {KNK_steel_input = 0}
            }
            KNK_steel_max_button_click = {
                set_variable = {KNK_steel_input = KNK_steel}
                KNK_clamp_input = yes
            }

            KNK_alum_add_1_button_click = {
                add_to_variable = {KNK_alum_input = 1}
                KNK_clamp_input = yes
            }
            KNK_alum_minus_1_button_click = {
                add_to_variable = {KNK_alum_input = -1}
                KNK_clamp_input = yes
            }
            KNK_alum_add_10_button_click = {
                add_to_variable = {KNK_alum_input = 10}
                KNK_clamp_input = yes
            }
            KNK_alum_minus_10_button_click = {
                add_to_variable = {KNK_alum_input = -10}
                KNK_clamp_input = yes
            }
            KNK_alum_add_100_button_click = {
                add_to_variable = {KNK_alum_input = 100}
                KNK_clamp_input = yes
            }
            KNK_alum_minus_100_button_click = {
                add_to_variable = {KNK_alum_input = -100}
                KNK_clamp_input = yes
            }
            KNK_alum_reset_button_click = {
                set_variable = {KNK_alum_input = 0}
            }
            KNK_alum_max_button_click = {
                set_variable = {KNK_alum_input = KNK_alum}
                KNK_clamp_input = yes
            }

            KNK_tech_add_1_button_click = {
                add_to_variable = {KNK_tech_input = 1}
            }
            KNK_tech_minus_1_button_click = {
                add_to_variable = {KNK_tech_input = -1}
            }

            KNK_start_button_click = {
                subtract_from_variable = {KNK_fuel = KNK_fuel_input}
                subtract_from_variable = {KNK_ammo = KNK_ammo_input}
                subtract_from_variable = {KNK_steel = KNK_steel_input}
                subtract_from_variable = {KNK_alum = KNK_alum_input}
                add_to_variable = {KNK_tech = -1}
                set_variable = {KNK_gui_window_2_var = 0}
                KNK_pick_pool_effect = yes

                meta_effect = {
                    text = {
                        set_country_flag = KNK_dock[KNK_DOCK_VAR]_occupied
                        set_variable = {KNK_dock[KNK_DOCK_VAR]_p = 0}
                    }
                    KNK_DOCK_VAR = "[?KNK_dock_var]"
                }

                sound_effect = "KNK_start"
            }
        }

        triggers = {
            KNK_start_button_click_enabled = {
                check_variable = {KNK_fuel_input > 29}
                check_variable = {var = KNK_fuel_input value = KNK_fuel compare = less_than_or_equals}
                check_variable = {KNK_ammo_input > 29}
                check_variable = {var = KNK_ammo_input value = KNK_ammo compare = less_than_or_equals}
                check_variable = {KNK_steel_input > 29}
                check_variable = {var = KNK_steel_input value = KNK_steel compare = less_than_or_equals}
                check_variable = {KNK_alum_input > 29}
                check_variable = {var = KNK_alum_input value = KNK_alum compare = less_than_or_equals}
                check_variable = {KNK_tech > 0}
            }
            KNK_tech_add_1_button_visible = {
                has_country_flag = KNK_great_project
            }
            KNK_tech_minus_1_button_visible = {
                has_country_flag = KNK_great_project
            }
        }
    }

    KNK_result_window = {
        context_type = player_context
        parent_window_token = "KNK_shipbuild_window"
        window_name = "KNK_result_window"

        visible = {
            tag = KNK
            check_variable = {KNK_new_ship_var = 1}
        }

        properties = {
            KNK_character_portrait = {
                image = "[KNK_get_new_character_image]"
            }
        }
        effects = {
            KNK_result_close_button_click = {
                set_variable = {KNK_new_ship_var = 0}
                sound_effect = "KNK_cancel"
            }
        }
    }
}